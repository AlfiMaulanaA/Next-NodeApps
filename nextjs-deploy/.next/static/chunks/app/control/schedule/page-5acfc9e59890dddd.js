(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4430],{4136:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});var n=r(5531);let s=(0,n.Z)("pen",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]])},3086:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});var n=r(5531);let s=(0,n.Z)("rotate-cw",[["path",{d:"M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8",key:"1p45f6"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}]])},5367:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});var n=r(5531);let s=(0,n.Z)("trash-2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]])},78:function(e,t,r){Promise.resolve().then(r.bind(r,3173))},3173:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return SchedulerPage}});var n=r(7437),s=r(2265),a=r(708),o=r(3611),c=r(9598),l=r(5217),i=r(307),d=r(5531);let u=(0,d.Z)("chart-no-axes-column-increasing",[["line",{x1:"12",x2:"12",y1:"20",y2:"10",key:"1vz5eb"}],["line",{x1:"18",x2:"18",y1:"20",y2:"4",key:"cun8e5"}],["line",{x1:"6",x2:"6",y1:"20",y2:"16",key:"hq0ia6"}]]);var f=r(3086),h=r(4136),g=r(5367),x=r(4631),b=r(9035),m=r(5744),p=r(2210),v=r(6989),y=r(3763),w=r(5184),j=r(4977),N=r(9790),k="Switch",[C,T]=(0,v.b)(k),[S,M]=C(k),_=s.forwardRef((e,t)=>{let{__scopeSwitch:r,name:a,checked:o,defaultChecked:c,required:l,disabled:i,value:d="on",onCheckedChange:u,form:f,...h}=e,[g,x]=s.useState(null),b=(0,p.e)(t,e=>x(e)),v=s.useRef(!1),w=!g||f||!!g.closest("form"),[j,C]=(0,y.T)({prop:o,defaultProp:c??!1,onChange:u,caller:k});return(0,n.jsxs)(S,{scope:r,checked:j,disabled:i,children:[(0,n.jsx)(N.WV.button,{type:"button",role:"switch","aria-checked":j,"aria-required":l,"data-state":getState(j),"data-disabled":i?"":void 0,disabled:i,value:d,...h,ref:b,onClick:(0,m.M)(e.onClick,e=>{C(e=>!e),w&&(v.current=e.isPropagationStopped(),v.current||e.stopPropagation())})}),w&&(0,n.jsx)(O,{control:g,bubbles:!v.current,name:a,value:d,checked:j,required:l,disabled:i,form:f,style:{transform:"translateX(-100%)"}})]})});_.displayName=k;var E="SwitchThumb",Z=s.forwardRef((e,t)=>{let{__scopeSwitch:r,...s}=e,a=M(E,r);return(0,n.jsx)(N.WV.span,{"data-state":getState(a.checked),"data-disabled":a.disabled?"":void 0,...s,ref:t})});Z.displayName=E;var O=s.forwardRef(({__scopeSwitch:e,control:t,checked:r,bubbles:a=!0,...o},c)=>{let l=s.useRef(null),i=(0,p.e)(l,c),d=(0,w.D)(r),u=(0,j.t)(t);return s.useEffect(()=>{let e=l.current;if(!e)return;let t=window.HTMLInputElement.prototype,n=Object.getOwnPropertyDescriptor(t,"checked"),s=n.set;if(d!==r&&s){let t=new Event("click",{bubbles:a});s.call(e,r),e.dispatchEvent(t)}},[d,r,a]),(0,n.jsx)("input",{type:"checkbox","aria-hidden":!0,defaultChecked:r,...o,tabIndex:-1,ref:i,style:{...o.style,...u,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});function getState(e){return e?"checked":"unchecked"}O.displayName="SwitchBubbleInput";var D=r(1628);let R=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,n.jsx)(_,{className:(0,D.cn)("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",r),...s,ref:t,children:(0,n.jsx)(Z,{className:(0,D.cn)("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})})});R.displayName=_.displayName;var P=r(1424);function SchedulerPage(){let[e,t]=(0,s.useState)([]),[r,d]=(0,s.useState)(!1),m=(0,b.w)(),p=(0,x.k)();(0,s.useEffect)(()=>{if(!p)return;let handleMessage=(e,r)=>{try{let e=JSON.parse(r.toString());Array.isArray(e.devices)?(t(e.devices),d(e.autoControl)):e.result&&P.Am.success(e.message||"Operation successful")}catch(e){console.error("Failed to parse MQTT message",e),P.Am.error("MQTT parsing error")}};return p.on("message",handleMessage),p.subscribe("response_control_scheduler"),p.publish("command_control_scheduler",JSON.stringify({action:"get"})),()=>{p.unsubscribe("response_control_scheduler"),p.off("message",handleMessage)}},[p]);let deleteDevice=e=>{null==p||p.publish("command_control_scheduler",JSON.stringify({action:"delete",data:{id:e}})),t(t=>t.filter(t=>t.id!==e)),P.Am.success("Device deleted")};return(0,n.jsxs)(i.kV,{children:[(0,n.jsxs)("header",{className:"flex h-16 items-center justify-between border-b px-4",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)(i.vP,{className:"-ml-1"}),(0,n.jsx)(l.Z,{orientation:"vertical",className:"mr-2 h-4"}),(0,n.jsx)(u,{className:"h-5 w-5 text-muted-foreground"}),(0,n.jsx)("h1",{className:"text-lg font-semibold",children:"Scheduler Control"})]}),(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)(a.C,{variant:"outline",className:"capitalize ".concat("connected"===m?"text-green-600 border-green-600":"error"===m?"text-red-600 border-red-600":"text-yellow-600 border-yellow-600"),children:m}),(0,n.jsx)(o.z,{variant:"outline",size:"icon",className:"h-8 w-8",onClick:()=>{null==p||p.publish("command_control_scheduler",JSON.stringify({action:"get"}))},children:(0,n.jsx)(f.Z,{})})]})]}),(0,n.jsxs)("div",{className:"p-4 space-y-4",children:[(0,n.jsxs)("div",{className:"flex justify-between items-center",children:[(0,n.jsx)("h2",{className:"text-base font-semibold",children:"Control State"}),(0,n.jsx)(R,{checked:r,onCheckedChange:d,onBlur:()=>{null==p||p.publish("command_control_scheduler",JSON.stringify({action:"update_autoControl",data:{autoControl:r}}))}})]}),e.length>0?e.map((e,t)=>(0,n.jsxs)(c.Zb,{children:[(0,n.jsxs)(c.Ol,{children:[(0,n.jsx)(c.ll,{className:"text-base",children:e.customName}),(0,n.jsxs)("div",{className:"text-sm text-muted-foreground",children:["Address: ",e.address," — Bus: ",e.device_bus," — Days: ",e.startDay,"–",e.endDay]})]}),(0,n.jsxs)(c.aY,{className:"space-y-2",children:[e.controls.map(e=>(0,n.jsxs)("div",{className:"text-sm flex justify-between",children:[(0,n.jsxs)("span",{children:[(0,n.jsx)("strong",{children:e.customName})," (Pin ",e.pin,")"]}),(0,n.jsxs)("span",{children:["On: ",e.onTime," — Off: ",e.offTime]})]},e.pin)),(0,n.jsxs)("div",{className:"flex gap-2 pt-2",children:[(0,n.jsxs)(o.z,{size:"sm",variant:"outline",children:[(0,n.jsx)(h.Z,{className:"h-4 w-4 mr-1"})," Edit"]}),(0,n.jsxs)(o.z,{size:"sm",variant:"destructive",onClick:()=>deleteDevice(e.id),children:[(0,n.jsx)(g.Z,{className:"h-4 w-4 mr-1"})," Delete"]})]})]})]},e.id)):(0,n.jsx)(c.Zb,{children:(0,n.jsx)(c.aY,{className:"p-4 text-center text-muted-foreground",children:"No scheduler devices found."})})]})]})}},708:function(e,t,r){"use strict";r.d(t,{C:function(){return Badge}});var n=r(7437);r(2265);var s=r(6061),a=r(1628);let o=(0,s.j)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",info:"border-transparent bg-blue-500 text-white hover:bg-blue-600",success:"border-transparent bg-green-500 text-white hover:bg-green-600",warning:"border-transparent bg-yellow-400 text-yellow-900 hover:bg-yellow-500",outline:"bg-transparent border-foreground text-foreground",outlineInfo:"bg-transparent border-blue-500 text-blue-600",outlineSuccess:"bg-transparent border-green-500 text-green-600",outlineWarning:"bg-transparent border-yellow-400 text-yellow-700",outlineDestructive:"bg-transparent border-destructive text-destructive",gradientInfo:"border-0 bg-gradient-to-r from-blue-400/50 to-blue-600/50 text-blue-900",gradientSuccess:"border-0 bg-gradient-to-r from-green-400/50 to-green-600/50 text-green-900",gradientWarning:"border-0 bg-gradient-to-r from-yellow-300/50 to-yellow-500/50 text-yellow-900",gradientDestructive:"border-0 bg-gradient-to-r from-red-400/50 to-red-600/50 text-red-900"}},defaultVariants:{variant:"default"}});function Badge(e){let{className:t,variant:r,...s}=e;return(0,n.jsx)("div",{className:(0,a.cn)(o({variant:r}),t),...s})}},9598:function(e,t,r){"use strict";r.d(t,{Ol:function(){return c},SZ:function(){return i},Zb:function(){return o},aY:function(){return d},eW:function(){return u},ll:function(){return l}});var n=r(7437),s=r(2265),a=r(1628);let o=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,n.jsx)("div",{ref:t,className:(0,a.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",r),...s})});o.displayName="Card";let c=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,n.jsx)("div",{ref:t,className:(0,a.cn)("flex flex-col space-y-1.5 p-6",r),...s})});c.displayName="CardHeader";let l=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,n.jsx)("div",{ref:t,className:(0,a.cn)("text-2xl font-semibold leading-none tracking-tight",r),...s})});l.displayName="CardTitle";let i=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,n.jsx)("div",{ref:t,className:(0,a.cn)("text-sm text-muted-foreground",r),...s})});i.displayName="CardDescription";let d=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,n.jsx)("div",{ref:t,className:(0,a.cn)("p-6 pt-0",r),...s})});d.displayName="CardContent";let u=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,n.jsx)("div",{ref:t,className:(0,a.cn)("flex items-center p-6 pt-0",r),...s})});u.displayName="CardFooter"},9035:function(e,t,r){"use strict";r.d(t,{w:function(){return useMQTTStatus}});var n=r(2265),s=r(4631);function useMQTTStatus(){let[e,t]=(0,n.useState)("connecting");return(0,n.useEffect)(()=>{let e=(0,s.k)(),handleConnect=()=>{console.log("✅ Connected to MQTT"),t("connected")},handleError=e=>{console.error("❌ MQTT Error",e),t("error")},handleClose=()=>{console.warn("⚠️ MQTT Disconnected"),t("disconnected")};return e.on("connect",handleConnect),e.on("error",handleError),e.on("close",handleClose),()=>{e.off("connect",handleConnect),e.off("error",handleError),e.off("close",handleClose)}},[]),e}},4631:function(e,t,r){"use strict";r.d(t,{O:function(){return getMQTTClient},k:function(){return connectMQTT}});var n=r(7406);let s=null;function connectMQTT(){let e="ws://localhost:9000";if(!e)throw Error("MQTT broker URL tidak didefinisikan di .env");return(!s||s.disconnected)&&(s=n.Z.connect(e,{clean:!0,connectTimeout:4e3,reconnectPeriod:1e3})),s}function getMQTTClient(){return s}},5184:function(e,t,r){"use strict";r.d(t,{D:function(){return usePrevious}});var n=r(2265);function usePrevious(e){let t=n.useRef({value:e,previous:e});return n.useMemo(()=>(t.current.value!==e&&(t.current.previous=t.current.value,t.current.value=e),t.current.previous),[e])}}},function(e){e.O(0,[2793,9848,5348,1424,307,2971,2472,1744],function(){return e(e.s=78)}),_N_E=e.O()}]);