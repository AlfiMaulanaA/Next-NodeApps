(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6981],{3715:function(e,l,a){"use strict";a.d(l,{Z:function(){return s}});var n=a(5531);let s=(0,n.Z)("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},4136:function(e,l,a){"use strict";a.d(l,{Z:function(){return s}});var n=a(5531);let s=(0,n.Z)("pen",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]])},5367:function(e,l,a){"use strict";a.d(l,{Z:function(){return s}});var n=a(5531);let s=(0,n.Z)("trash-2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]])},9136:function(e,l,a){"use strict";a.d(l,{Z:function(){return s}});var n=a(5531);let s=(0,n.Z)("triangle-alert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]])},2369:function(e,l,a){"use strict";a.d(l,{Z:function(){return s}});var n=a(5531);let s=(0,n.Z)("zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]])},1875:function(e,l,a){Promise.resolve().then(a.bind(a,6011))},6011:function(e,l,a){"use strict";a.r(l),a.d(l,{default:function(){return AutomationValuesPage}});var n=a(7437),s=a(2265),t=a(7406),c=a(1424),i=a(307),r=a(5217),d=a(3611),o=a(2031),u=a(5831),h=a(2369),x=a(4196),j=a(4136),m=a(5367),p=a(8772),v=a(6005),g=a(9719),f=a(9652),y=a(8965),b=a(7532);function AutomationValuesPage(){let[e,l]=(0,s.useState)("disconnected"),[a,k]=(0,s.useState)([]),[N,C]=(0,s.useState)([]),[S,w]=(0,s.useState)([]),[Z,A]=(0,s.useState)(!1),[_,M]=(0,s.useState)(null),[z,V]=(0,s.useState)(""),[O,P]=(0,s.useState)(""),[T,E]=(0,s.useState)(""),[Q,B]=(0,s.useState)(""),[D,F]=(0,s.useState)(0),[q,I]=(0,s.useState)(""),[L,R]=(0,s.useState)(""),[J,W]=(0,s.useState)(!1),U=(0,s.useRef)();(0,s.useEffect)(()=>{let e=t.Z.connect("ws://localhost:9000");return e.on("connect",()=>{l("connected"),e.subscribe("automation_value/data"),e.subscribe("modbus_value/data"),e.subscribe("modular_value/data")}),e.on("error",()=>l("error")),e.on("close",()=>l("disconnected")),e.on("message",(e,l)=>{let a=JSON.parse(l.toString());e.endsWith("automation_value/data")&&k(a),e.endsWith("modbus_value/data")&&C(a),e.endsWith("modular_value/data")&&w(a)}),U.current=e,()=>{e.end()}},[]);let resetForm=()=>{V(""),P(""),E(""),B(""),F(0),I(""),R(""),W(!1),M(null)},openModal=e=>{e?(M(e),V(e.name),P(e.topic),E(e.config.key_value),B(e.config.logic),F(e.config.value),I(e.relay.name),R(e.relay.pin),W(e.relay.logic)):resetForm(),A(!0)},remove=e=>{var l;let a=JSON.stringify({name:e.name});null===(l=U.current)||void 0===l||l.publish("automation_value/delete",a),c.Am.success("Deleted")},{searchQuery:$,setSearchQuery:H,filteredData:K}=(0,g.d)(a,["name","topic"]),{sorted:G,sortField:X,sortDirection:Y,handleSort:ee}=(0,f.E)(K),[el,ea]=(0,s.useState)(1),en=Math.ceil(G.length/10),es=G.slice((el-1)*10,10*el);return(0,n.jsxs)(i.kV,{children:[(0,n.jsxs)("header",{className:"flex h-16 items-center justify-between border-b px-4",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)(i.vP,{}),(0,n.jsx)(r.Z,{orientation:"vertical",className:"h-4"}),(0,n.jsx)(h.Z,{className:"w-5 h-5 text-muted-foreground"}),(0,n.jsx)("h1",{className:"text-lg font-semibold",children:"Automation Values"})]}),(0,n.jsx)(p.Z,{})]}),(0,n.jsxs)("div",{className:"p-6 space-y-4",children:[(0,n.jsxs)("div",{className:"flex flex-wrap justify-between items-center mb-4 gap-2",children:[(0,n.jsx)(d.z,{size:"sm",variant:"default",onClick:()=>openModal(),children:"Add Automation"}),(0,n.jsx)("input",{type:"text",placeholder:"Search...",className:"border rounded px-2 py-1 w-64",value:$,onChange:e=>H(e.target.value)})]}),(0,n.jsxs)(v.iA,{children:[(0,n.jsx)(v.xD,{children:(0,n.jsxs)(v.SC,{children:[(0,n.jsx)(v.ss,{children:"#"}),(0,n.jsxs)(v.ss,{onClick:()=>ee("name"),className:"cursor-pointer select-none",children:["Name / Topic ",(0,n.jsx)(x.Z,{className:"inline w-4 h-4 ml-1 align-middle"})]}),(0,n.jsx)(v.ss,{children:"Trigger"}),(0,n.jsx)(v.ss,{children:"Relay"}),(0,n.jsx)(v.ss,{children:"Actions"})]})}),(0,n.jsx)(v.RM,{children:es.length?es.map((e,l)=>(0,n.jsxs)(v.SC,{children:[(0,n.jsx)(v.pj,{children:(el-1)*10+l+1}),(0,n.jsxs)(v.pj,{children:[(0,n.jsx)("div",{className:"font-semibold",children:e.name}),(0,n.jsx)("div",{className:"text-muted text-xs",children:e.topic})]}),(0,n.jsx)(v.pj,{className:"text-center",children:(0,n.jsxs)("span",{className:"badge",children:[e.config.key_value," ",e.config.logic," ",e.config.value]})}),(0,n.jsxs)(v.pj,{className:"text-center",children:[e.relay.name," pin ",e.relay.pin," = ",(0,n.jsx)("strong",{children:e.relay.logic?"ON":"OFF"})]}),(0,n.jsxs)(v.pj,{className:"flex gap-1 justify-center",children:[(0,n.jsx)(d.z,{size:"icon",onClick:()=>openModal(e),children:(0,n.jsx)(j.Z,{})}),(0,n.jsx)(d.z,{size:"icon",variant:"destructive",onClick:()=>remove(e),children:(0,n.jsx)(m.Z,{})})]})]},l)):(0,n.jsx)(v.SC,{children:(0,n.jsx)(v.pj,{colSpan:5,className:"text-center text-muted-foreground py-8",children:'No automation data. Click "Add Automation" to create one.'})})})]}),(0,n.jsx)(y.tl,{className:"mt-4",children:(0,n.jsxs)(y.ng,{children:[(0,n.jsx)(y.dN,{onClick:()=>ea(e=>Math.max(1,e-1))}),Array.from({length:en},(e,l)=>(0,n.jsx)(y.nt,{children:(0,n.jsx)(y.kN,{isActive:el===l+1,onClick:()=>ea(l+1),children:l+1})},l)),(0,n.jsx)(y.$0,{onClick:()=>ea(e=>Math.min(en,e+1))})]})}),(0,n.jsx)(o.Vq,{open:Z,onOpenChange:A,children:(0,n.jsxs)(o.cZ,{children:[(0,n.jsx)(o.fK,{children:(0,n.jsx)(o.$N,{children:_?"Edit Automation":"Add Automation"})}),(0,n.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{children:"Device"}),(0,n.jsxs)(b.Ph,{value:z,onValueChange:V,children:[(0,n.jsx)(b.i4,{children:(0,n.jsx)(b.ki,{placeholder:"Select.."})}),(0,n.jsx)(b.Bw,{children:N.map(e=>(0,n.jsx)(b.Ql,{value:e.profile.name,children:e.profile.name},e.profile.name))})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{children:"Topic"}),(0,n.jsx)(u.I,{value:O,onChange:e=>P(e.target.value)})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{children:"Variable"}),(0,n.jsx)(u.I,{value:T,onChange:e=>E(e.target.value)})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{children:"Logic"}),(0,n.jsxs)(b.Ph,{value:Q,onValueChange:B,children:[(0,n.jsx)(b.i4,{children:(0,n.jsx)(b.ki,{placeholder:"Select.."})}),(0,n.jsx)(b.Bw,{children:[" >","<",">=","<=","==","!="].map(e=>(0,n.jsx)(b.Ql,{value:e,children:e},e))})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{children:"Value"}),(0,n.jsx)(u.I,{type:"number",value:D,onChange:e=>F(Number(e.target.value))})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{children:"Relay Device"}),(0,n.jsxs)(b.Ph,{value:q,onValueChange:I,children:[(0,n.jsx)(b.i4,{children:(0,n.jsx)(b.ki,{placeholder:"Select.."})}),(0,n.jsx)(b.Bw,{children:S.map(e=>(0,n.jsx)(b.Ql,{value:e.profile.name,children:e.profile.name},e.profile.name))})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{children:"Pin"}),(0,n.jsx)(u.I,{value:L,onChange:e=>R(e.target.value)})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{children:"Output Logic"}),(0,n.jsxs)(b.Ph,{value:J?"true":"false",onValueChange:e=>W("true"===e),children:[(0,n.jsx)(b.i4,{children:(0,n.jsx)(b.ki,{placeholder:"Select.."})}),(0,n.jsxs)(b.Bw,{children:[(0,n.jsx)(b.Ql,{value:"true",children:"True"}),(0,n.jsx)(b.Ql,{value:"false",children:"False"})]})]})]})]}),(0,n.jsx)(o.cN,{children:(0,n.jsx)(d.z,{onClick:()=>{var e;let l=_?{..._,config:{key_value:T,logic:Q,value:D},relay:{name:q,pin:L,logic:J}}:{name:z,topic:O,config:{key_value:T,logic:Q,value:D},relay:{name:q,pin:L,logic:J}},a=_?"automation_value/update":"automation_value/create";null===(e=U.current)||void 0===e||e.publish(a,JSON.stringify(l)),c.Am.success(_?"Updated":"Created"),A(!1)},children:_?"Update":"Create"})})]})})]})]})}},8772:function(e,l,a){"use strict";a.d(l,{Z:function(){return MQTTConnectionBadge}});var n=a(7437),s=a(9035),t=a(708),c=a(5531);let i=(0,c.Z)("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);var r=a(9136);let d=(0,c.Z)("circle-x",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);var o=a(3715);function MQTTConnectionBadge(){let e=(0,s.w)(),{color:l,icon:a,label:c}=(()=>{switch(e){case"connected":return{color:"bg-green-500",icon:(0,n.jsx)(i,{className:"w-4 h-4 mr-1"}),label:"Connected"};case"disconnected":return{color:"bg-yellow-500",icon:(0,n.jsx)(r.Z,{className:"w-4 h-4 mr-1"}),label:"Disconnected"};case"error":return{color:"bg-red-500",icon:(0,n.jsx)(d,{className:"w-4 h-4 mr-1"}),label:"Error"};default:return{color:"bg-gray-400",icon:(0,n.jsx)(o.Z,{className:"w-4 h-4 mr-1 animate-spin"}),label:"Connecting..."}}})();return(0,n.jsxs)(t.C,{className:"flex items-center ".concat(l," text-white px-2 py-1"),children:[a,(0,n.jsx)("span",{className:"text-sm",children:c})]})}}},function(e){e.O(0,[2793,9848,5348,1424,298,307,97,2971,2472,1744],function(){return e(e.s=1875)}),_N_E=e.O()}]);