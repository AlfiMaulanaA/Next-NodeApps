(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9826],{1923:function(e,t,n){Promise.resolve().then(n.bind(n,2247))},2247:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return CustomPayloadPage}});var a=n(7437),s=n(2265),l=n(1424),r=n(307),o=n(5217),c=n(9598),i=n(3611),d=n(2031),u=n(5831),m=n(5505),f=n(4196),x=n(4136),h=n(5367),p=n(4248),g=n(9670),v=n(6577),j=n(6005),y=n(9719),b=n(9652),N=n(8965),w=n(4829),k=n(5344),C=n(6820),_=n.n(C),T=n(7532);function CustomPayloadPage(){let[e,t]=(0,s.useState)("disconnected"),[n,C]=(0,s.useState)(null),[S,P]=(0,s.useState)([]),[D,A]=(0,s.useState)(!1),[R,Q]=(0,s.useState)(null),[M,O]=(0,s.useState)(""),[Z,z]=(0,s.useState)(!1),[V,F]=(0,s.useState)(0),[E,I]=(0,s.useState)(10),[B,K]=(0,s.useState)([{name:"",part_number:"",keyOptions:[],value_keys:[{key:"",value:""}]}]),[L,q]=(0,s.useState)([]),[G,Y]=(0,s.useState)(!1),[H,J]=(0,s.useState)(null),U=(0,s.useRef)({}),$=(0,s.useRef)(null),W=(0,s.useCallback)(()=>{var e;(null===(e=$.current)||void 0===e?void 0:e.connected)?(console.log("Publishing getDeviceInfo command..."),$.current.publish("config/device_info",JSON.stringify({command:"getDeviceInfo"}))):console.warn("MQTT not connected, cannot publish getDeviceInfo.")},[]),X=(0,s.useCallback)(()=>{var e;(null===(e=$.current)||void 0===e?void 0:e.connected)?(console.log("Publishing getData command to config/summary_device..."),$.current.publish("config/summary_device",JSON.stringify({command:"getData"}))):(console.warn("MQTT not connected, cannot publish getData."),l.Am.error("MQTT not connected. Cannot fetch data."))},[]),ee=(0,s.useCallback)((e,t)=>{var n;if(!(null===(n=$.current)||void 0===n?void 0:n.connected)){l.Am.error("MQTT not connected. Please wait for connection or refresh.");return}$.current.publish("config/summary_device",JSON.stringify({command:e,data:t}),t=>{t?(l.Am.error("Failed to send command: ".concat(t.message)),console.error("Publish error:",t)):"getData"!==e&&l.Am.info("Command '".concat(e,"' sent. Awaiting response..."))})},[]),et=(0,s.useCallback)(()=>{t("connected"),l.Am.success("MQTT Connected!"),$.current&&($.current.subscribe("config/device_info/response",{qos:1}),$.current.subscribe("config/summary_device/response",{qos:1}),console.log("Subscribed to response topics."),W(),X())},[W,X]),en=(0,s.useCallback)(e=>{console.error("MQTT Client Error:",e),t("error"),l.Am.error("MQTT Error: ".concat(e.message))},[]),ea=(0,s.useCallback)(()=>{t("disconnected"),l.Am.info("MQTT connection closed.")},[]),es=(0,s.useCallback)((e,t)=>{try{let n=JSON.parse(t.toString());console.log("[handleMessage] Topic: ".concat(e,", Payload:"),n),e.endsWith("/device_info/response")?Array.isArray(n)?(P(n),console.log("Updated devicesInfo from MQTT:",n)):console.warn("Received non-array for device_info/response:",n):e.endsWith("/summary_device/response")&&(n&&Array.isArray(n.groups)?(C(n),console.log("Summary config data loaded successfully:",n),l.Am.success("Custom payload configurations updated!")):n&&("success"===n.status||"error"===n.status)?(l.Am["success"===n.status?"success":"error"](n.message||"Operation ".concat(n.status,".")),"success"===n.status&&setTimeout(()=>{X()},500)):console.warn("Unexpected summary_device/response format (not `groups` or `status`):",n))}catch(e){console.error("MQTT message parsing error:",e)}},[X]);(0,s.useEffect)(()=>{w.Z.get("/devices.json").then(e=>{let t={},n=Array.isArray(e.data)?e.data:Object.values(e.data).flat();n.forEach(e=>{e.part_number&&e.data&&Array.isArray(e.data)&&(t[e.part_number]=e.data.map(e=>e.var_name))}),U.current=t,console.log("Loaded deviceKeyOptionsMap from devices.json:",t)}).catch(e=>{console.error("Failed to load devices.json:",e),l.Am.error("Failed to load device key options from devices.json.")})},[]),(0,s.useEffect)(()=>{if($.current)$.current.connected&&(console.log("MQTT client already connected. Triggering initial data fetch."),W(),X());else{console.log("Attempting to connect to MQTT broker...");let e=(0,k.kS)();return $.current=e,e.on("connect",et),e.on("error",en),e.on("close",ea),e.on("message",es),()=>{let e=$.current;e&&(console.log("MQTT client cleanup."),e.connected&&(e.unsubscribe("config/device_info/response"),e.unsubscribe("config/summary_device/response")),e.off("connect",et),e.off("error",en),e.off("close",ea),e.off("message",es),e.connected&&e.end(!0,()=>console.log("MQTT client disconnected.")))}}},[et,en,ea,es,W,X]);let openEditor=e=>{if(void 0!==e&&n&&n.groups[e]){let t=n.groups[e];O(t.summary_topic),z(t.retain),F(t.qos),I(t.interval),K(t.included_devices.map(e=>{let t=S.find(t=>t.name===e.name);return{name:e.name,part_number:(null==t?void 0:t.part_number)||"",value_group:e.value_group,keyOptions:U.current[(null==t?void 0:t.part_number)||""]||[],value_keys:Object.entries(e.value_keys).map(e=>{let[t,n]=e;return{key:t,value:n}})}})),q(t.calculations||[]),Y(t.calculation_only||!1),Q(e)}else O(""),z(!1),F(0),I(10),K([{name:"",part_number:"",keyOptions:[],value_keys:[{key:"",value:""}]}]),q([]),Y(!1),Q(null);J(null),A(!0)},handleDeleteGroup=e=>{var t;let a=null==n?void 0:null===(t=n.groups[e])||void 0===t?void 0:t.summary_topic;a?_().fire({title:"Are you sure?",text:"You won't be able to revert this!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, delete it!"}).then(e=>{e.isConfirmed&&(ee("deleteData",{summary_topic:a}),l.Am.info("Sending delete command for topic: ".concat(a)))}):l.Am.error("Could not find topic to delete.")},handleRemoveDeviceFromForm=e=>{let t=B.filter((t,n)=>n!==e);K(t)},handleDeviceSelectionInForm=(e,t)=>{let n=[...B],a=S.find(e=>e.name===t);a?n[e]={...n[e],name:t,part_number:a.part_number,keyOptions:U.current[a.part_number]||[],value_keys:[{key:"",value:""}]}:n[e]={...n[e],name:t,part_number:"",keyOptions:[],value_keys:[{key:"",value:""}]},K(n)},handleAddValueKeyToDevice=e=>{let t=[...B];t[e].value_keys.push({key:"",value:""}),K(t)},handleRemoveValueKeyFromDevice=(e,t)=>{let n=[...B];n[e].value_keys.splice(t,1),K(n)},handleValueKeyChange=(e,t,n,a)=>{let s=[...B];s[e].value_keys[t][n]=a,K(s)},{searchQuery:el,setSearchQuery:er,filteredData:eo}=(0,y.d)((null==n?void 0:n.groups)||[],["summary_topic","included_devices.name"]),{sorted:ec,sortField:ei,sortDirection:ed,handleSort:eu}=(0,b.E)(eo),[em,ef]=(0,s.useState)(1),ex=Math.ceil(ec.length/10),eh=ec.slice((em-1)*10,10*em),ep=Array.from(new Set(B.map(e=>e.value_group).filter(Boolean)));return(0,a.jsxs)(r.kV,{children:[(0,a.jsxs)("header",{className:"flex h-16 items-center justify-between border-b px-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(r.vP,{}),(0,a.jsx)(o.Z,{orientation:"vertical",className:"h-4"}),(0,a.jsx)(m.Z,{className:"w-5 h-5 text-muted-foreground"}),(0,a.jsx)("h1",{className:"text-lg font-semibold",children:"Custom Payload Data"})]}),(0,a.jsx)(v.Z,{})]}),(0,a.jsxs)("div",{className:"p-6 space-y-4",children:[(0,a.jsxs)("div",{className:"flex flex-wrap justify-between items-center mb-4 gap-2",children:[(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(i.z,{size:"sm",variant:"secondary",onClick:X,children:"Fetch Data"}),(0,a.jsx)(i.z,{size:"sm",variant:"default",onClick:()=>openEditor(),children:"Create New Data"})]}),(0,a.jsx)(u.I,{type:"text",placeholder:"Search by topic or device name...",className:"w-full md:w-64",value:el,onChange:e=>er(e.target.value)})]}),(0,a.jsxs)(j.iA,{children:[(0,a.jsx)(j.xD,{children:(0,a.jsxs)(j.SC,{children:[(0,a.jsxs)(j.ss,{onClick:()=>eu("summary_topic"),className:"cursor-pointer select-none",children:["Topic ",(0,a.jsx)(f.Z,{className:"inline w-4 h-4 ml-1 align-middle"})]}),(0,a.jsx)(j.ss,{children:"Devices"}),(0,a.jsxs)(j.ss,{onClick:()=>eu("retain"),className:"cursor-pointer select-none",children:["Retain ",(0,a.jsx)(f.Z,{className:"inline w-4 h-4 ml-1 align-middle"})]}),(0,a.jsxs)(j.ss,{onClick:()=>eu("qos"),className:"cursor-pointer select-none",children:["QoS ",(0,a.jsx)(f.Z,{className:"inline w-4 h-4 ml-1 align-middle"})]}),(0,a.jsxs)(j.ss,{onClick:()=>eu("interval"),className:"cursor-pointer select-none",children:["Interval ",(0,a.jsx)(f.Z,{className:"inline w-4 h-4 ml-1 align-middle"})]}),(0,a.jsx)(j.ss,{children:"Actions"})]})}),(0,a.jsx)(j.RM,{children:eh.length>0?eh.map((e,t)=>(0,a.jsxs)(j.SC,{children:[(0,a.jsx)(j.pj,{className:"font-medium",children:e.summary_topic}),(0,a.jsxs)(j.pj,{children:[(0,a.jsx)("ul",{className:"list-disc list-inside text-sm",children:e.included_devices.map((t,n)=>(0,a.jsxs)("li",{children:[(0,a.jsx)("strong",{children:t.name}),t.value_group&&(0,a.jsxs)("span",{className:"text-muted-foreground ml-1",children:["(",t.value_group,")"]}),(0,a.jsx)("ul",{className:"ml-4 list-none",children:Object.entries(t.value_keys).map(n=>{let[s,l]=n;return(0,a.jsxs)("li",{className:"flex justify-between items-center",children:[(0,a.jsxs)("span",{className:"text-xs text-muted-foreground",children:[s,":"]}),(0,a.jsx)("span",{className:"text-xs font-semibold",children:l})]},"".concat(e.summary_topic,"-").concat(t.name,"-").concat(s))})})]},"".concat(e.summary_topic,"-").concat(t.name,"-").concat(n)))}),e.calculations.length>0&&(0,a.jsxs)("div",{className:"mt-2 text-xs",children:[(0,a.jsx)("span",{className:"font-semibold",children:"Calculations:"}),(0,a.jsx)("ul",{className:"ml-2 list-disc list-inside",children:e.calculations.map((e,t)=>(0,a.jsxs)("li",{children:[e.operation," (",e.value_group_selected,") as ",e.name]},t))})]}),e.calculation_only&&(0,a.jsxs)("div",{className:"mt-1 text-xs text-blue-600",children:[(0,a.jsx)("span",{className:"font-semibold",children:"Note:"})," Only calculated values will be published."]})]}),(0,a.jsx)(j.pj,{children:e.retain?"✔️":"❌"}),(0,a.jsx)(j.pj,{children:e.qos}),(0,a.jsxs)(j.pj,{children:[e.interval,"s"]}),(0,a.jsxs)(j.pj,{className:"flex gap-2",children:[(0,a.jsx)(i.z,{size:"icon",variant:"outline",onClick:()=>openEditor(t),title:"Edit",children:(0,a.jsx)(x.Z,{className:"w-4 h-4"})}),(0,a.jsx)(i.z,{size:"icon",variant:"destructive",onClick:()=>handleDeleteGroup(t),title:"Delete",children:(0,a.jsx)(h.Z,{className:"w-4 h-4"})})]})]},e.summary_topic)):(0,a.jsx)(j.SC,{children:(0,a.jsx)(j.pj,{colSpan:6,className:"text-center text-muted-foreground py-8",children:'No custom payload configurations found. Click "Create New Data" to add a new configuration.'})})})]}),ex>1&&(0,a.jsx)(N.tl,{className:"mt-4",children:(0,a.jsxs)(N.ng,{children:[(0,a.jsx)(N.dN,{onClick:()=>ef(e=>Math.max(1,e-1))}),Array.from({length:ex},(e,t)=>(0,a.jsx)(N.nt,{children:(0,a.jsx)(N.kN,{isActive:em===t+1,onClick:()=>ef(t+1),children:t+1})},t)),(0,a.jsx)(N.$0,{onClick:()=>ef(e=>Math.min(ex,e+1))})]})}),(0,a.jsx)(d.Vq,{open:D,onOpenChange:A,children:(0,a.jsxs)(d.cZ,{className:"max-w-3xl overflow-y-auto max-h-[90vh]",children:[(0,a.jsxs)(d.fK,{children:[(0,a.jsx)(d.$N,{children:null===R?"Add Custom Payload":"Edit Custom Payload"}),(0,a.jsx)(d.Be,{children:"Configure custom MQTT payloads by defining topics, QoS, retention settings, and including devices with specific value keys. You can also define calculations."})]}),(0,a.jsxs)("div",{className:"space-y-4 py-2",children:[(0,a.jsxs)(c.Zb,{children:[(0,a.jsx)(c.Ol,{children:(0,a.jsx)(c.ll,{className:"text-md",children:"Payload Details"})}),(0,a.jsxs)(c.aY,{className:"space-y-3",children:[(0,a.jsx)(u.I,{placeholder:"Summary Topic",value:M,onChange:e=>O(e.target.value),required:!0}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsx)("label",{htmlFor:"qos-select",className:"text-sm font-medium mb-1",children:"QoS Level"}),(0,a.jsxs)(T.Ph,{value:String(V),onValueChange:e=>F(Number(e)),children:[(0,a.jsx)(T.i4,{id:"qos-select",className:"w-full",children:(0,a.jsx)(T.ki,{placeholder:"Select QoS Level"})}),(0,a.jsxs)(T.Bw,{children:[(0,a.jsx)(T.Ql,{value:"0",children:"0 (At most once)"}),(0,a.jsx)(T.Ql,{value:"1",children:"1 (At least once)"}),(0,a.jsx)(T.Ql,{value:"2",children:"2 (Exactly once)"})]})]})]}),(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsx)("label",{htmlFor:"interval-input",className:"text-sm font-medium mb-1",children:"Interval (seconds)"}),(0,a.jsx)(u.I,{id:"interval-input",placeholder:"Interval",type:"number",value:E,onChange:e=>I(Number(e.target.value)),required:!0,min:1})]}),(0,a.jsxs)("div",{className:"flex items-center mt-auto pt-2",children:[(0,a.jsx)("input",{type:"checkbox",id:"retain-checkbox",checked:Z,onChange:e=>z(e.target.checked),className:"mr-2 h-4 w-4"}),(0,a.jsx)("label",{htmlFor:"retain-checkbox",className:"text-sm font-medium leading-none",children:"Retain Message"})]})]})]})]}),(0,a.jsxs)(c.Zb,{children:[(0,a.jsxs)(c.Ol,{className:"flex flex-row justify-between items-center",children:[(0,a.jsx)(c.ll,{className:"text-md",children:"Included Devices"}),(0,a.jsxs)(i.z,{size:"sm",variant:"outline",onClick:()=>{K([...B,{name:"",part_number:"",keyOptions:[],value_keys:[{key:"",value:""}]}])},children:[(0,a.jsx)(p.Z,{className:"mr-2 h-4 w-4"})," Add Device"]})]}),(0,a.jsxs)(c.aY,{className:"space-y-4",children:[0===B.length&&(0,a.jsx)("p",{className:"text-center text-muted-foreground",children:'No devices added. Click "Add Device" to start.'}),B.map((e,t)=>(0,a.jsxs)("div",{className:"p-4 border rounded-md space-y-3 bg-gray-50",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("label",{className:"text-sm font-medium",children:["Device ",t+1]}),B.length>1&&(0,a.jsx)(i.z,{variant:"destructive",size:"sm",onClick:()=>handleRemoveDeviceFromForm(t),children:"Remove Device"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsx)("label",{htmlFor:"device-select-".concat(t),className:"text-sm font-medium mb-1",children:"Select Device"}),(0,a.jsxs)(T.Ph,{value:e.name,onValueChange:e=>handleDeviceSelectionInForm(t,e),children:[(0,a.jsx)(T.i4,{id:"device-select-".concat(t),className:"w-full",children:(0,a.jsx)(T.ki,{placeholder:"Select Device"})}),(0,a.jsx)(T.Bw,{children:(0,a.jsx)(T.DI,{children:0===S.length?(0,a.jsx)(T.n5,{children:"Loading devices..."}):S.map(e=>(0,a.jsxs)(T.Ql,{value:e.name,children:[e.name," (",e.part_number,")"]},e.name))})})]})]}),(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsx)("label",{htmlFor:"value-group-".concat(t),className:"text-sm font-medium mb-1",children:"Value Group (Optional)"}),(0,a.jsx)(u.I,{id:"value-group-".concat(t),placeholder:"Enter Value Group",value:e.value_group||"",onChange:e=>{let n=[...B];n[t].value_group=e.target.value,K(n)}})]})]}),(0,a.jsx)("h5",{className:"text-sm font-semibold mt-3",children:"Value Keys:"}),0===e.value_keys.length&&(0,a.jsx)("p",{className:"text-center text-muted-foreground text-xs",children:"No keys added for this device."}),e.value_keys.map((n,s)=>(0,a.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,a.jsxs)(T.Ph,{value:n.key,onValueChange:e=>handleValueKeyChange(t,s,"key",e),children:[(0,a.jsx)(T.i4,{className:"flex-1",children:(0,a.jsx)(T.ki,{placeholder:"Select Key"})}),(0,a.jsx)(T.Bw,{children:(0,a.jsx)(T.DI,{children:0===e.keyOptions.length?(0,a.jsx)(T.n5,{children:"No keys available for this device."}):e.keyOptions.map(e=>(0,a.jsx)(T.Ql,{value:e,children:e},e))})})]}),(0,a.jsx)(u.I,{placeholder:"Assign Value",value:n.value,className:"flex-1",onChange:e=>handleValueKeyChange(t,s,"value",e.target.value),required:!0}),(0,a.jsx)(i.z,{variant:"destructive",size:"icon",onClick:()=>handleRemoveValueKeyFromDevice(t,s),title:"Remove Key",children:(0,a.jsx)(h.Z,{className:"w-4 h-4"})})]},s)),(0,a.jsxs)(i.z,{size:"sm",variant:"secondary",onClick:()=>handleAddValueKeyToDevice(t),className:"mt-2",children:[(0,a.jsx)(p.Z,{className:"mr-2 h-4 w-4"})," Add Key"]})]},t))]})]}),(0,a.jsxs)(c.Zb,{children:[(0,a.jsxs)(c.Ol,{className:"flex flex-row justify-between items-center",children:[(0,a.jsx)(c.ll,{className:"text-md",children:"Calculations (Optional)"}),(0,a.jsxs)(i.z,{size:"sm",variant:"outline",onClick:()=>q([...L,{operation:"",name:"",value_group_selected:""}]),children:[(0,a.jsx)(p.Z,{className:"mr-2 h-4 w-4"})," Add Calculation"]})]}),(0,a.jsxs)(c.aY,{className:"space-y-4",children:[0===L.length&&(0,a.jsx)("p",{className:"text-center text-muted-foreground",children:'No calculations added. Click "Add Calculation" to start.'}),L.map((e,t)=>(0,a.jsxs)("div",{className:"p-4 border rounded-md space-y-3 bg-gray-50",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("label",{className:"text-sm font-medium",children:["Calculation ",t+1]}),(0,a.jsx)(i.z,{variant:"destructive",size:"sm",onClick:()=>q(L.filter((e,n)=>n!==t)),children:"Remove Calculation"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsx)("label",{htmlFor:"calc-op-".concat(t),className:"text-sm font-medium mb-1",children:"Operation"}),(0,a.jsxs)(T.Ph,{value:e.operation,onValueChange:e=>{let n=[...L];n[t].operation=e,q(n)},children:[(0,a.jsx)(T.i4,{id:"calc-op-".concat(t),className:"w-full",children:(0,a.jsx)(T.ki,{placeholder:"Select Operation"})}),(0,a.jsx)(T.Bw,{children:(0,a.jsxs)(T.DI,{children:[(0,a.jsx)(T.Ql,{value:"sum",children:"Sum"}),(0,a.jsx)(T.Ql,{value:"average",children:"Average"}),(0,a.jsx)(T.Ql,{value:"multiply",children:"Multiply"}),(0,a.jsx)(T.Ql,{value:"divide",children:"Divide"})]})})]})]}),(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsx)("label",{htmlFor:"calc-name-".concat(t),className:"text-sm font-medium mb-1",children:"Calculation Name"}),(0,a.jsx)(u.I,{id:"calc-name-".concat(t),placeholder:"e.g., total_power",value:e.name,onChange:e=>{let n=[...L];n[t].name=e.target.value,q(n)}})]}),(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsx)("label",{htmlFor:"calc-vg-".concat(t),className:"text-sm font-medium mb-1",children:"Source Value Group"}),(0,a.jsxs)(T.Ph,{value:e.value_group_selected,onValueChange:e=>{let n=[...L];n[t].value_group_selected=e,q(n)},children:[(0,a.jsx)(T.i4,{id:"calc-vg-".concat(t),className:"w-full",children:(0,a.jsx)(T.ki,{placeholder:"Select Value Group"})}),(0,a.jsx)(T.Bw,{children:(0,a.jsx)(T.DI,{children:0===ep.length?(0,a.jsx)(T.n5,{children:"No value groups defined in devices."}):ep.map((e,t)=>(0,a.jsx)(T.Ql,{value:e,children:e},t))})})]})]})]})]},t)),(0,a.jsxs)("div",{className:"flex items-center mt-auto pt-2",children:[(0,a.jsx)("input",{type:"checkbox",id:"calculation-only-checkbox",checked:G,onChange:e=>Y(e.target.checked),className:"mr-2 h-4 w-4"}),(0,a.jsx)("label",{htmlFor:"calculation-only-checkbox",className:"text-sm font-medium leading-none",children:"Publish only calculated values (exclude raw device data)"})]})]})]}),(0,a.jsxs)(c.Zb,{children:[(0,a.jsxs)(c.Ol,{className:"flex flex-row justify-between items-center",children:[(0,a.jsx)(c.ll,{className:"text-md",children:"Payload Preview"}),(0,a.jsxs)(i.z,{size:"sm",variant:"outline",onClick:()=>{let e={summary_topic:M,retain:Z,qos:V,interval:E,included_devices:B.map(e=>({name:e.name,value_group:e.value_group,value_keys:Object.fromEntries(e.value_keys.map(e=>[e.key,e.value]))})),calculations:L,calculation_only:G};J(JSON.stringify(e,null,2))},children:[(0,a.jsx)(g.Z,{className:"mr-2 h-4 w-4"})," Generate Preview"]})]}),(0,a.jsx)(c.aY,{children:H?(0,a.jsx)("pre",{className:"bg-gray-100 p-3 rounded-md text-xs overflow-x-auto whitespace-pre-wrap",children:H}):(0,a.jsx)("p",{className:"text-muted-foreground text-sm",children:'Click "Generate Preview" to see the JSON payload that will be sent to the middleware.'})})]})]}),(0,a.jsxs)(d.cN,{children:[(0,a.jsx)(i.z,{variant:"outline",onClick:()=>A(!1),children:"Cancel"}),(0,a.jsx)(i.z,{onClick:()=>{if(!M.trim()){l.Am.error("Summary Topic cannot be empty.");return}if(0===B.length||B.some(e=>!e.name.trim()||e.value_keys.some(e=>!e.key.trim()||!e.value.trim()))){l.Am.error("Please ensure all devices and their value keys are correctly filled.");return}if(L.some(e=>!e.operation||!e.name||!e.value_group_selected)){l.Am.error("Please ensure all calculation fields are correctly filled.");return}let e={summary_topic:M,retain:Z,qos:V,interval:E,included_devices:B.map(e=>({name:e.name,value_group:e.value_group,value_keys:Object.fromEntries(e.value_keys.map(e=>[e.key,e.value]))})),calculations:L,calculation_only:G};ee("writeData",e),l.Am.info("Sending ".concat(null===R?"create":"update"," command...")),A(!1)},children:"Save Configuration"})]})]})})]})]})}},6577:function(e,t,n){"use strict";n.d(t,{Z:function(){return MQTTConnectionBadge}});var a=n(7437),s=n(9035),l=n(708),r=n(4530),o=n(4631),c=n(9806),i=n(3715);function MQTTConnectionBadge(){let e=(0,s.w)(),{color:t,icon:n,label:d}=(()=>{switch(e){case"connected":return{color:"bg-green-500",icon:(0,a.jsx)(r.Z,{className:"w-4 h-4 mr-1"}),label:"Connected"};case"disconnected":return{color:"bg-yellow-500",icon:(0,a.jsx)(o.Z,{className:"w-4 h-4 mr-1"}),label:"Disconnected"};case"error":return{color:"bg-red-500",icon:(0,a.jsx)(c.Z,{className:"w-4 h-4 mr-1"}),label:"Error"};default:return{color:"bg-gray-400",icon:(0,a.jsx)(i.Z,{className:"w-4 h-4 mr-1 animate-spin"}),label:"Connecting..."}}})();return(0,a.jsxs)(l.C,{className:"flex items-center ".concat(t," text-white px-2 py-1"),children:[n,(0,a.jsx)("span",{className:"text-sm",children:d})]})}},708:function(e,t,n){"use strict";n.d(t,{C:function(){return Badge}});var a=n(7437);n(2265);var s=n(6061),l=n(1628);let r=(0,s.j)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",info:"border-transparent bg-blue-500 text-white hover:bg-blue-600",success:"border-transparent bg-green-500 text-white hover:bg-green-600",warning:"border-transparent bg-yellow-400 text-yellow-900 hover:bg-yellow-500",outline:"bg-transparent border-foreground text-foreground",outlineInfo:"bg-transparent border-blue-500 text-blue-600",outlineSuccess:"bg-transparent border-green-500 text-green-600",outlineWarning:"bg-transparent border-yellow-400 text-yellow-700",outlineDestructive:"bg-transparent border-destructive text-destructive",gradientInfo:"border-0 bg-gradient-to-r from-blue-400/50 to-blue-600/50 text-blue-900",gradientSuccess:"border-0 bg-gradient-to-r from-green-400/50 to-green-600/50 text-green-900",gradientWarning:"border-0 bg-gradient-to-r from-yellow-300/50 to-yellow-500/50 text-yellow-900",gradientDestructive:"border-0 bg-gradient-to-r from-red-400/50 to-red-600/50 text-red-900"}},defaultVariants:{variant:"default"}});function Badge(e){let{className:t,variant:n,...s}=e;return(0,a.jsx)("div",{className:(0,l.cn)(r({variant:n}),t),...s})}},9598:function(e,t,n){"use strict";n.d(t,{Ol:function(){return o},SZ:function(){return i},Zb:function(){return r},aY:function(){return d},eW:function(){return u},ll:function(){return c}});var a=n(7437),s=n(2265),l=n(1628);let r=s.forwardRef((e,t)=>{let{className:n,...s}=e;return(0,a.jsx)("div",{ref:t,className:(0,l.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",n),...s})});r.displayName="Card";let o=s.forwardRef((e,t)=>{let{className:n,...s}=e;return(0,a.jsx)("div",{ref:t,className:(0,l.cn)("flex flex-col space-y-1.5 p-6",n),...s})});o.displayName="CardHeader";let c=s.forwardRef((e,t)=>{let{className:n,...s}=e;return(0,a.jsx)("div",{ref:t,className:(0,l.cn)("text-2xl font-semibold leading-none tracking-tight",n),...s})});c.displayName="CardTitle";let i=s.forwardRef((e,t)=>{let{className:n,...s}=e;return(0,a.jsx)("div",{ref:t,className:(0,l.cn)("text-sm text-muted-foreground",n),...s})});i.displayName="CardDescription";let d=s.forwardRef((e,t)=>{let{className:n,...s}=e;return(0,a.jsx)("div",{ref:t,className:(0,l.cn)("p-6 pt-0",n),...s})});d.displayName="CardContent";let u=s.forwardRef((e,t)=>{let{className:n,...s}=e;return(0,a.jsx)("div",{ref:t,className:(0,l.cn)("flex items-center p-6 pt-0",n),...s})});u.displayName="CardFooter"},2031:function(e,t,n){"use strict";n.d(t,{$N:function(){return f},Be:function(){return x},Vq:function(){return c},cN:function(){return DialogFooter},cZ:function(){return m},fK:function(){return DialogHeader},hg:function(){return i}});var a=n(7437),s=n(2265),l=n(8712),r=n(2549),o=n(1628);let c=l.fC,i=l.xz,d=l.h_;l.x8;let u=s.forwardRef((e,t)=>{let{className:n,...s}=e;return(0,a.jsx)(l.aV,{ref:t,className:(0,o.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",n),...s})});u.displayName=l.aV.displayName;let m=s.forwardRef((e,t)=>{let{className:n,children:s,...c}=e;return(0,a.jsxs)(d,{children:[(0,a.jsx)(u,{}),(0,a.jsxs)(l.VY,{ref:t,className:(0,o.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",n),...c,children:[s,(0,a.jsxs)(l.x8,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,a.jsx)(r.Z,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});m.displayName=l.VY.displayName;let DialogHeader=e=>{let{className:t,...n}=e;return(0,a.jsx)("div",{className:(0,o.cn)("flex flex-col space-y-1.5 text-center sm:text-left",t),...n})};DialogHeader.displayName="DialogHeader";let DialogFooter=e=>{let{className:t,...n}=e;return(0,a.jsx)("div",{className:(0,o.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...n})};DialogFooter.displayName="DialogFooter";let f=s.forwardRef((e,t)=>{let{className:n,...s}=e;return(0,a.jsx)(l.Dx,{ref:t,className:(0,o.cn)("text-lg font-semibold leading-none tracking-tight",n),...s})});f.displayName=l.Dx.displayName;let x=s.forwardRef((e,t)=>{let{className:n,...s}=e;return(0,a.jsx)(l.dk,{ref:t,className:(0,o.cn)("text-sm text-muted-foreground",n),...s})});x.displayName=l.dk.displayName},8965:function(e,t,n){"use strict";n.d(t,{$0:function(){return PaginationNext},dN:function(){return PaginationPrevious},kN:function(){return PaginationLink},ng:function(){return i},nt:function(){return d},tl:function(){return Pagination}});var a=n(7437),s=n(2265),l=n(1291),r=n(7158),o=(n(9534),n(1628)),c=n(3611);let Pagination=e=>{let{className:t,...n}=e;return(0,a.jsx)("nav",{role:"navigation","aria-label":"pagination",className:(0,o.cn)("mx-auto flex w-full justify-center",t),...n})};Pagination.displayName="Pagination";let i=s.forwardRef((e,t)=>{let{className:n,...s}=e;return(0,a.jsx)("ul",{ref:t,className:(0,o.cn)("flex flex-row items-center gap-1",n),...s})});i.displayName="PaginationContent";let d=s.forwardRef((e,t)=>{let{className:n,...s}=e;return(0,a.jsx)("li",{ref:t,className:(0,o.cn)("",n),...s})});d.displayName="PaginationItem";let PaginationLink=e=>{let{className:t,isActive:n,size:s="icon",...l}=e;return(0,a.jsx)("a",{"aria-current":n?"page":void 0,className:(0,o.cn)((0,c.d)({variant:n?"outline":"ghost",size:s}),t),...l})};PaginationLink.displayName="PaginationLink";let PaginationPrevious=e=>{let{className:t,...n}=e;return(0,a.jsxs)(PaginationLink,{"aria-label":"Go to previous page",size:"default",className:(0,o.cn)("gap-1 pl-2.5",t),...n,children:[(0,a.jsx)(l.Z,{className:"h-4 w-4"}),(0,a.jsx)("span",{children:"Previous"})]})};PaginationPrevious.displayName="PaginationPrevious";let PaginationNext=e=>{let{className:t,...n}=e;return(0,a.jsxs)(PaginationLink,{"aria-label":"Go to next page",size:"default",className:(0,o.cn)("gap-1 pr-2.5",t),...n,children:[(0,a.jsx)("span",{children:"Next"}),(0,a.jsx)(r.Z,{className:"h-4 w-4"})]})};PaginationNext.displayName="PaginationNext"},7532:function(e,t,n){"use strict";n.d(t,{Bw:function(){return p},DI:function(){return u},Ph:function(){return d},Ql:function(){return v},i4:function(){return f},ki:function(){return m},n5:function(){return g}});var a=n(7437),s=n(2265),l=n(6337),r=n(3523),o=n(9224),c=n(2442),i=n(1628);let d=l.fC,u=l.ZA,m=l.B4,f=s.forwardRef((e,t)=>{let{className:n,children:s,...o}=e;return(0,a.jsxs)(l.xz,{ref:t,className:(0,i.cn)("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",n),...o,children:[s,(0,a.jsx)(l.JO,{asChild:!0,children:(0,a.jsx)(r.Z,{className:"h-4 w-4 opacity-50"})})]})});f.displayName=l.xz.displayName;let x=s.forwardRef((e,t)=>{let{className:n,...s}=e;return(0,a.jsx)(l.u_,{ref:t,className:(0,i.cn)("flex cursor-default items-center justify-center py-1",n),...s,children:(0,a.jsx)(o.Z,{className:"h-4 w-4"})})});x.displayName=l.u_.displayName;let h=s.forwardRef((e,t)=>{let{className:n,...s}=e;return(0,a.jsx)(l.$G,{ref:t,className:(0,i.cn)("flex cursor-default items-center justify-center py-1",n),...s,children:(0,a.jsx)(r.Z,{className:"h-4 w-4"})})});h.displayName=l.$G.displayName;let p=s.forwardRef((e,t)=>{let{className:n,children:s,position:r="popper",...o}=e;return(0,a.jsx)(l.h_,{children:(0,a.jsxs)(l.VY,{ref:t,className:(0,i.cn)("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===r&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",n),position:r,...o,children:[(0,a.jsx)(x,{}),(0,a.jsx)(l.l_,{className:(0,i.cn)("p-1","popper"===r&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:s}),(0,a.jsx)(h,{})]})})});p.displayName=l.VY.displayName;let g=s.forwardRef((e,t)=>{let{className:n,...s}=e;return(0,a.jsx)(l.__,{ref:t,className:(0,i.cn)("py-1.5 pl-8 pr-2 text-sm font-semibold",n),...s})});g.displayName=l.__.displayName;let v=s.forwardRef((e,t)=>{let{className:n,children:s,...r}=e;return(0,a.jsxs)(l.ck,{ref:t,className:(0,i.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",n),...r,children:[(0,a.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,a.jsx)(l.wU,{children:(0,a.jsx)(c.Z,{className:"h-4 w-4"})})}),(0,a.jsx)(l.eT,{children:s})]})});v.displayName=l.ck.displayName;let j=s.forwardRef((e,t)=>{let{className:n,...s}=e;return(0,a.jsx)(l.Z0,{ref:t,className:(0,i.cn)("-mx-1 my-1 h-px bg-muted",n),...s})});j.displayName=l.Z0.displayName},6005:function(e,t,n){"use strict";n.d(t,{RM:function(){return c},Rn:function(){return f},SC:function(){return d},iA:function(){return r},pj:function(){return m},ss:function(){return u},xD:function(){return o}});var a=n(7437),s=n(2265),l=n(1628);let r=s.forwardRef((e,t)=>{let{className:n,...s}=e;return(0,a.jsx)("div",{className:"relative w-full overflow-auto",children:(0,a.jsx)("table",{ref:t,className:(0,l.cn)("w-full caption-bottom text-sm",n),...s})})});r.displayName="Table";let o=s.forwardRef((e,t)=>{let{className:n,...s}=e;return(0,a.jsx)("thead",{ref:t,className:(0,l.cn)("[&_tr]:border-b",n),...s})});o.displayName="TableHeader";let c=s.forwardRef((e,t)=>{let{className:n,...s}=e;return(0,a.jsx)("tbody",{ref:t,className:(0,l.cn)("[&_tr:last-child]:border-0",n),...s})});c.displayName="TableBody";let i=s.forwardRef((e,t)=>{let{className:n,...s}=e;return(0,a.jsx)("tfoot",{ref:t,className:(0,l.cn)("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",n),...s})});i.displayName="TableFooter";let d=s.forwardRef((e,t)=>{let{className:n,...s}=e;return(0,a.jsx)("tr",{ref:t,className:(0,l.cn)("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",n),...s})});d.displayName="TableRow";let u=s.forwardRef((e,t)=>{let{className:n,...s}=e;return(0,a.jsx)("th",{ref:t,className:(0,l.cn)("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",n),...s})});u.displayName="TableHead";let m=s.forwardRef((e,t)=>{let{className:n,...s}=e;return(0,a.jsx)("td",{ref:t,className:(0,l.cn)("p-4 align-middle [&:has([role=checkbox])]:pr-0",n),...s})});m.displayName="TableCell";let f=s.forwardRef((e,t)=>{let{className:n,...s}=e;return(0,a.jsx)("caption",{ref:t,className:(0,l.cn)("mt-4 text-sm text-muted-foreground",n),...s})});f.displayName="TableCaption"},9719:function(e,t,n){"use strict";n.d(t,{d:function(){return useSearchFilter}});var a=n(2265);function getValueByKeyPath(e,t){let n=t.split("."),a=e;for(let e of n){if(!a||"object"!=typeof a)return"";a=a[e]}return String(null!=a?a:"")}function useSearchFilter(e,t){let[n,s]=(0,a.useState)(""),l=(0,a.useMemo)(()=>{if(!n)return e;let a=n.toLowerCase();return e.filter(e=>t.some(t=>getValueByKeyPath(e,t).toLowerCase().includes(a)))},[n,e,t]);return{searchQuery:n,setSearchQuery:s,filteredData:l}}},9652:function(e,t,n){"use strict";n.d(t,{E:function(){return useSortableTable}});var a=n(2265);function getNestedValue(e,t){return t.split(".").reduce((e,t)=>e&&"object"==typeof e?e[t]:void 0,e)}function useSortableTable(e){let[t,n]=(0,a.useState)(null),[s,l]=(0,a.useState)("asc"),r=[...e].sort((e,n)=>{if(!t)return 0;let a=getNestedValue(e,t),l=getNestedValue(n,t),r=null!=a?a:"",o=null!=l?l:"";return"string"==typeof r&&"string"==typeof o?"asc"===s?r.localeCompare(o):o.localeCompare(r):"number"==typeof r&&"number"==typeof o?"asc"===s?r-o:o-r:0});return{sorted:r,sortField:t,sortDirection:s,handleSort:e=>{t===e?l(e=>"asc"===e?"desc":"asc"):(n(e),l("asc"))}}}},9035:function(e,t,n){"use strict";n.d(t,{w:function(){return useMQTTStatus}});var a=n(2265),s=n(5344);function useMQTTStatus(){let e=(0,s.Oh)(),[t,n]=(0,a.useState)(()=>e?e.connected?"connected":e.disconnected?"disconnected":"connecting":"connecting");return(0,a.useEffect)(()=>{let e=(0,s.kS)();e.connected?n("connected"):e.disconnected?n("disconnected"):n("connecting");let handleConnect=()=>n("connected"),handleError=()=>n("error"),handleClose=()=>n("disconnected"),handleReconnect=()=>n("connecting"),handleOffline=()=>n("disconnected");return e.on("connect",handleConnect),e.on("error",handleError),e.on("close",handleClose),e.on("reconnect",handleReconnect),e.on("offline",handleOffline),()=>{e.off("connect",handleConnect),e.off("error",handleError),e.off("close",handleClose),e.off("reconnect",handleReconnect),e.off("offline",handleOffline)}},[]),t}},5344:function(e,t,n){"use strict";n.d(t,{kS:function(){return connectMQTT},Oh:function(){return getMQTTClient}});var a=n(7406);function getAppConfig(){let e,t;let n=window.location.protocol;if("https:"===n?(e="ws://192.168.0.106:9000",t="http://192.168.0.100:8000"):(e="ws://".concat(window.location.hostname,":9000"),t="http://".concat(window.location.hostname,":8000")),!e)throw Error("MQTT broker URL is not defined.");if(!t)throw Error("API base URL is not defined.");return{mqttBrokerUrl:e,apiBaseUrl:t}}let s=null,l=!1;function connectMQTT(){let{mqttBrokerUrl:e}=getAppConfig();if(!e)throw Error("MQTT broker URL is missing from configuration.");if(s&&(s.connected||l))return s;if(!s||s.disconnected){if(l)return s;l=!0,console.log("MQTT: Attempting connection to ".concat(e,"...")),(s=a.Z.connect(e,{clean:!0,connectTimeout:3e3,reconnectPeriod:1e3})).on("connect",()=>{console.log("MQTT: Connected to ".concat(e)),l=!1}),s.on("error",e=>{console.error("MQTT Error: ".concat(e.message)),l=!1}),s.on("reconnect",()=>{console.log("MQTT: Reconnecting to ".concat(e)),l=!0}),s.on("close",()=>{console.log("MQTT: Connection to ".concat(e," closed.")),l=!1}),s.on("offline",()=>{console.log("MQTT: Client is offline."),l=!1})}return s}function getMQTTClient(){return s}}},function(e){e.O(0,[2793,9461,9848,5348,6107,2995,2539,307,2971,2472,1744],function(){return e(e.s=1923)}),_N_E=e.O()}]);