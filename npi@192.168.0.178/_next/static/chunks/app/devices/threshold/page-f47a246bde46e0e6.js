(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4931],{2663:function(e,t,n){Promise.resolve().then(n.bind(n,255))},255:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return BatteryThresholdPage}});var r=n(7437),o=n(2265),a=n(1865),s=n(8969),i=n(8110),c=n(2031),l=n(3611),d=n(5831),u=n(5344),f=n(5217),g=n(307),m=n(1392),h=n(3086),b=n(6577),x=n(6820),p=n.n(x),T=n(1424);let y=s.Ry({AC_INPUT_THRESHOLD:s.Rx().min(0,"Must be a non-negative number."),DC_BATTERY_VOLTAGE:s.Rx().min(0,"Must be a non-negative number."),DC_BATTERY_TOLERANCE:s.Rx().min(0,"Must be a non-negative number."),DC_OUTPUT_THRESHOLD:s.Rx().min(0,"Must be a non-negative number."),DC_OUTPUT_THRESHOLD_NORMAL:s.Rx().min(0,"Must be a non-negative number."),MIN_CURRENT_THRESHOLD:s.Rx().min(0,"Must be a non-negative number.")});function BatteryThresholdPage(){let[e,t]=(0,o.useState)(!1),[n,s]=(0,o.useState)({}),{register:x,handleSubmit:N,setValue:v,reset:C,formState:{errors:j}}=(0,a.cI)({resolver:(0,i.F)(y),defaultValues:{AC_INPUT_THRESHOLD:0,DC_BATTERY_VOLTAGE:0,DC_BATTERY_TOLERANCE:0,DC_OUTPUT_THRESHOLD:0,DC_OUTPUT_THRESHOLD_NORMAL:0,MIN_CURRENT_THRESHOLD:0}});return(0,o.useEffect)(()=>{let e=(0,u.kS)();if(!e){T.Am.error("MQTT client not initialized.");return}e.subscribe("batteryCharger/config/response"),e.subscribe("batteryCharger/config/update/response");let handleMessage=(t,n)=>{try{let r=JSON.parse(n.toString());"batteryCharger/config/response"===t?(s(r),C(r)):"batteryCharger/config/update/response"===t&&(T.Am.dismiss("updateConfig"),"success"===r.status?(p().fire({position:"top-end",icon:"success",title:r.message||"Configuration updated successfully!",showConfirmButton:!1,timer:3e3,toast:!0}),e.publish("batteryCharger/config/get","")):p().fire({position:"top-end",icon:"error",title:r.message||"Failed to update configuration.",showConfirmButton:!1,timer:3e3,toast:!0}))}catch(e){console.error("Failed to parse MQTT message:",e),T.Am.error("Received invalid data from MQTT.")}};return e.on("message",handleMessage),e.publish("batteryCharger/config/get",""),()=>{e.off("message",handleMessage),e.unsubscribe("batteryCharger/config/response"),e.unsubscribe("batteryCharger/config/update/response")}},[C]),(0,r.jsxs)(g.kV,{children:[(0,r.jsxs)("header",{className:"flex h-16 items-center justify-between border-b px-4",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(g.vP,{className:"-ml-1"}),(0,r.jsx)(f.Z,{orientation:"vertical",className:"h-4"}),(0,r.jsx)(m.Z,{className:"w-5 h-5 text-muted-foreground"}),(0,r.jsx)("h1",{className:"text-lg font-semibold",children:"Battery Threshold Configuration"})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(b.Z,{}),(0,r.jsx)(l.z,{variant:"outline",size:"icon",onClick:()=>{let e=(0,u.kS)();e?(e.publish("batteryCharger/config/get",""),T.Am.info("Requesting latest configuration...")):T.Am.error("MQTT client not available.")},children:(0,r.jsx)(h.Z,{className:"w-4 h-4"})})]})]}),(0,r.jsxs)("div",{className:"p-6 space-y-4",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold",children:"Battery Threshold Configuration"}),(0,r.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 ",children:Object.entries(y.shape).map(e=>{var t;let[o]=e;return(0,r.jsxs)("div",{className:"flex flex-col bg-muted p-4 rounded-md border text-sm",children:[(0,r.jsx)("span",{className:"text-muted-foreground text-xs",children:o}),(0,r.jsx)("span",{className:"font-medium",children:null!==(t=null==n?void 0:n[o])&&void 0!==t?t:"â€”"})]},o)})}),(0,r.jsxs)(c.Vq,{open:e,onOpenChange:t,children:[(0,r.jsx)(c.hg,{asChild:!0,children:(0,r.jsx)(l.z,{children:"Edit Threshold"})}),(0,r.jsxs)(c.cZ,{children:[(0,r.jsxs)(c.fK,{children:[(0,r.jsx)(c.$N,{children:"Update Battery Threshold"}),(0,r.jsx)(c.Be,{children:"Modify only values you want to update"})]}),(0,r.jsxs)("form",{onSubmit:N(e=>{let n=(0,u.kS)();if(!n||!n.connected){T.Am.error("MQTT not connected. Please wait or refresh.");return}n.publish("batteryCharger/config/update",JSON.stringify(e),e=>{e?(T.Am.error("Failed to send update command: ".concat(e.message)),console.error("Publish error:",e)):T.Am.loading("Updating configuration...",{id:"updateConfig"})}),t(!1)}),className:"grid gap-4 py-4",children:[Object.keys(y.shape).map(e=>{var t,n;return(0,r.jsxs)("div",{className:"grid gap-1",children:[(0,r.jsx)("label",{htmlFor:e,className:"text-sm font-medium",children:e}),(0,r.jsx)(d.I,{id:e,type:"number",step:"any",...x(e,{valueAsNumber:!0})}),(null==j?void 0:j[e])&&(0,r.jsx)("span",{className:"text-sm text-red-500",children:null===(n=j[e])||void 0===n?void 0:null===(t=n.message)||void 0===t?void 0:t.toString()})]},e)}),(0,r.jsx)(c.cN,{children:(0,r.jsx)(l.z,{type:"submit",children:"Update"})})]})]})]})]})]})}},6577:function(e,t,n){"use strict";n.d(t,{Z:function(){return MQTTConnectionBadge}});var r=n(7437),o=n(9035),a=n(708),s=n(4530),i=n(4631),c=n(9806),l=n(3715);function MQTTConnectionBadge(){let e=(0,o.w)(),{color:t,icon:n,label:d}=(()=>{switch(e){case"connected":return{color:"bg-green-500",icon:(0,r.jsx)(s.Z,{className:"w-4 h-4 mr-1"}),label:"Connected"};case"disconnected":return{color:"bg-yellow-500",icon:(0,r.jsx)(i.Z,{className:"w-4 h-4 mr-1"}),label:"Disconnected"};case"error":return{color:"bg-red-500",icon:(0,r.jsx)(c.Z,{className:"w-4 h-4 mr-1"}),label:"Error"};default:return{color:"bg-gray-400",icon:(0,r.jsx)(l.Z,{className:"w-4 h-4 mr-1 animate-spin"}),label:"Connecting..."}}})();return(0,r.jsxs)(a.C,{className:"flex items-center ".concat(t," text-white px-2 py-1"),children:[n,(0,r.jsx)("span",{className:"text-sm",children:d})]})}},708:function(e,t,n){"use strict";n.d(t,{C:function(){return Badge}});var r=n(7437);n(2265);var o=n(6061),a=n(1628);let s=(0,o.j)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",info:"border-transparent bg-blue-500 text-white hover:bg-blue-600",success:"border-transparent bg-green-500 text-white hover:bg-green-600",warning:"border-transparent bg-yellow-400 text-yellow-900 hover:bg-yellow-500",outline:"bg-transparent border-foreground text-foreground",outlineInfo:"bg-transparent border-blue-500 text-blue-600",outlineSuccess:"bg-transparent border-green-500 text-green-600",outlineWarning:"bg-transparent border-yellow-400 text-yellow-700",outlineDestructive:"bg-transparent border-destructive text-destructive",gradientInfo:"border-0 bg-gradient-to-r from-blue-400/50 to-blue-600/50 text-blue-900",gradientSuccess:"border-0 bg-gradient-to-r from-green-400/50 to-green-600/50 text-green-900",gradientWarning:"border-0 bg-gradient-to-r from-yellow-300/50 to-yellow-500/50 text-yellow-900",gradientDestructive:"border-0 bg-gradient-to-r from-red-400/50 to-red-600/50 text-red-900"}},defaultVariants:{variant:"default"}});function Badge(e){let{className:t,variant:n,...o}=e;return(0,r.jsx)("div",{className:(0,a.cn)(s({variant:n}),t),...o})}},2031:function(e,t,n){"use strict";n.d(t,{$N:function(){return g},Be:function(){return m},Vq:function(){return c},cN:function(){return DialogFooter},cZ:function(){return f},fK:function(){return DialogHeader},hg:function(){return l}});var r=n(7437),o=n(2265),a=n(8712),s=n(2549),i=n(1628);let c=a.fC,l=a.xz,d=a.h_;a.x8;let u=o.forwardRef((e,t)=>{let{className:n,...o}=e;return(0,r.jsx)(a.aV,{ref:t,className:(0,i.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",n),...o})});u.displayName=a.aV.displayName;let f=o.forwardRef((e,t)=>{let{className:n,children:o,...c}=e;return(0,r.jsxs)(d,{children:[(0,r.jsx)(u,{}),(0,r.jsxs)(a.VY,{ref:t,className:(0,i.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",n),...c,children:[o,(0,r.jsxs)(a.x8,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,r.jsx)(s.Z,{className:"h-4 w-4"}),(0,r.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});f.displayName=a.VY.displayName;let DialogHeader=e=>{let{className:t,...n}=e;return(0,r.jsx)("div",{className:(0,i.cn)("flex flex-col space-y-1.5 text-center sm:text-left",t),...n})};DialogHeader.displayName="DialogHeader";let DialogFooter=e=>{let{className:t,...n}=e;return(0,r.jsx)("div",{className:(0,i.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...n})};DialogFooter.displayName="DialogFooter";let g=o.forwardRef((e,t)=>{let{className:n,...o}=e;return(0,r.jsx)(a.Dx,{ref:t,className:(0,i.cn)("text-lg font-semibold leading-none tracking-tight",n),...o})});g.displayName=a.Dx.displayName;let m=o.forwardRef((e,t)=>{let{className:n,...o}=e;return(0,r.jsx)(a.dk,{ref:t,className:(0,i.cn)("text-sm text-muted-foreground",n),...o})});m.displayName=a.dk.displayName},9035:function(e,t,n){"use strict";n.d(t,{w:function(){return useMQTTStatus}});var r=n(2265),o=n(5344);function useMQTTStatus(){let e=(0,o.Oh)(),[t,n]=(0,r.useState)(()=>e?e.connected?"connected":e.disconnected?"disconnected":"connecting":"connecting");return(0,r.useEffect)(()=>{let e=(0,o.kS)();e.connected?n("connected"):e.disconnected?n("disconnected"):n("connecting");let handleConnect=()=>n("connected"),handleError=()=>n("error"),handleClose=()=>n("disconnected"),handleReconnect=()=>n("connecting"),handleOffline=()=>n("disconnected");return e.on("connect",handleConnect),e.on("error",handleError),e.on("close",handleClose),e.on("reconnect",handleReconnect),e.on("offline",handleOffline),()=>{e.off("connect",handleConnect),e.off("error",handleError),e.off("close",handleClose),e.off("reconnect",handleReconnect),e.off("offline",handleOffline)}},[]),t}},5344:function(e,t,n){"use strict";n.d(t,{kS:function(){return connectMQTT},Oh:function(){return getMQTTClient}});var r=n(7406);function getAppConfig(){let e,t;let n=window.location.protocol;if("https:"===n?(e="ws://192.168.0.106:9000",t="http://192.168.0.100:8000"):(e="ws://".concat(window.location.hostname,":9000"),t="http://".concat(window.location.hostname,":8000")),!e)throw Error("MQTT broker URL is not defined.");if(!t)throw Error("API base URL is not defined.");return{mqttBrokerUrl:e,apiBaseUrl:t}}let o=null,a=!1;function connectMQTT(){let{mqttBrokerUrl:e}=getAppConfig();if(!e)throw Error("MQTT broker URL is missing from configuration.");if(o&&(o.connected||a))return o;if(!o||o.disconnected){if(a)return o;a=!0,console.log("MQTT: Attempting connection to ".concat(e,"...")),(o=r.Z.connect(e,{clean:!0,connectTimeout:3e3,reconnectPeriod:1e3})).on("connect",()=>{console.log("MQTT: Connected to ".concat(e)),a=!1}),o.on("error",e=>{console.error("MQTT Error: ".concat(e.message)),a=!1}),o.on("reconnect",()=>{console.log("MQTT: Reconnecting to ".concat(e)),a=!0}),o.on("close",()=>{console.log("MQTT: Connection to ".concat(e," closed.")),a=!1}),o.on("offline",()=>{console.log("MQTT: Client is offline."),a=!1})}return o}function getMQTTClient(){return o}}},function(e){e.O(0,[2793,9461,9848,5348,6107,8969,307,2971,2472,1744],function(){return e(e.s=2663)}),_N_E=e.O()}]);