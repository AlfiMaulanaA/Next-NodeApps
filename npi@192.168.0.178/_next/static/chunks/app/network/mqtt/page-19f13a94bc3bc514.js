(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1110],{6435:function(e,n,t){Promise.resolve().then(t.bind(t,85))},85:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return MqttConfigPage}});var r=t(7437),o=t(2265),s=t(1424),a=t(307),i=t(5217),c=t(9598),l=t(3611),d=t(5831),u=t(1465),f=t(1750),m=t(2031),g=t(6714),x=t(4280),p=t(4136),h=t(3715),b=t(5344),j=t(6577);function MqttConfigPage(){let[e,n]=(0,o.useState)("mqtt"),[t,c]=(0,o.useState)(null),[h,N]=(0,o.useState)(null),[v,w]=(0,o.useState)({username:"",password:"",broker_address:"",broker_port:0}),[y,C]=(0,o.useState)(!1),T=(0,o.useRef)(null),k=(0,o.useCallback)(()=>{let e=(0,b.Oh)();e&&e.connected?setTimeout(()=>{e.publish("mqtt_config/request",JSON.stringify({action:"readConfiguration"})),e.publish("mqtt_config_modbus/request",JSON.stringify({action:"readConfiguration"})),s.Am.info("Requesting latest configurations...")},300):s.Am.warning("MQTT not connected. Cannot request configuration.")},[]);(0,o.useEffect)(()=>{let e=(0,b.kS)();T.current=e;let n=["mqtt_config","mqtt_config_modbus","service/response"];n.forEach(n=>{e.subscribe(n,e=>{e&&console.error("Failed to subscribe to ".concat(n,":"),e)})}),e.connected&&k();let handleConnect=()=>{k()},handleMessage=(e,n)=>{try{let t=JSON.parse(n.toString());"mqtt_config"===e?(c(t),s.Am.success("MQTT Modular Config Loaded! \uD83C\uDF89")):"mqtt_config_modbus"===e?(N(t),s.Am.success("MQTT Modbus Config Loaded! \uD83D\uDE80")):"service/response"===e&&t.message&&s.Am.success(t.message)}catch(e){s.Am.error("Invalid response format from MQTT. Check backend payload."),console.error("Error parsing MQTT message. Raw string:",n.toString(),"Error:",e)}};return e.on("connect",handleConnect),e.on("message",handleMessage),()=>{T.current&&(n.forEach(e=>{var n;null===(n=T.current)||void 0===n||n.unsubscribe(e)}),T.current.off("connect",handleConnect),T.current.off("message",handleMessage))}},[k]);let handleInput=(e,n)=>{w(t=>({...t,[e]:n}))},openEditModal=()=>{let n="mqtt"===e?t:h;n?(w(n),C(!0)):s.Am.error("Configuration not loaded yet. Ensure MQTT connection and try refreshing. ⏳")};return(0,r.jsxs)(a.kV,{children:[(0,r.jsxs)("header",{className:"flex h-16 items-center justify-between border-b px-4",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(a.vP,{className:"-ml-1"}),(0,r.jsx)(i.Z,{orientation:"vertical",className:"h-4"}),(0,r.jsx)(g.Z,{className:"w-5 h-5 text-muted-foreground"}),(0,r.jsx)("h1",{className:"text-lg font-semibold",children:"MQTT Configuration"})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(j.Z,{}),(0,r.jsx)(l.z,{variant:"outline",size:"icon",onClick:k,children:(0,r.jsx)(x.Z,{className:"w-4 h-4"})})]})]}),(0,r.jsxs)("div",{className:"p-6",children:[(0,r.jsxs)(f.mQ,{value:e,onValueChange:e=>n(e),children:[(0,r.jsxs)(f.dr,{children:[(0,r.jsx)(f.SP,{value:"mqtt",children:"MQTT Modular"}),(0,r.jsx)(f.SP,{value:"modbus",children:"MQTT Modbus"})]}),(0,r.jsx)(f.nU,{value:"mqtt",children:(0,r.jsx)(ConfigView,{config:t,onEdit:openEditModal})}),(0,r.jsx)(f.nU,{value:"modbus",children:(0,r.jsx)(ConfigView,{config:h,onEdit:openEditModal})})]}),(0,r.jsxs)(m.Vq,{open:y,onOpenChange:C,children:[(0,r.jsx)(m.hg,{asChild:!0}),(0,r.jsxs)(m.cZ,{children:[(0,r.jsx)(m.fK,{children:(0,r.jsx)(m.$N,{children:"Edit Configuration"})}),(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsx)(u._,{htmlFor:"username",children:"Username"}),(0,r.jsx)(d.I,{id:"username",placeholder:"Username",value:v.username,onChange:e=>handleInput("username",e.target.value)}),(0,r.jsx)(u._,{htmlFor:"password",children:"Password"}),(0,r.jsx)(d.I,{id:"password",placeholder:"Password",value:v.password,type:"password",onChange:e=>handleInput("password",e.target.value)}),(0,r.jsx)(u._,{htmlFor:"broker_address",children:"Broker Address"}),(0,r.jsx)(d.I,{id:"broker_address",placeholder:"Broker Address",value:v.broker_address,onChange:e=>handleInput("broker_address",e.target.value)}),(0,r.jsx)(u._,{htmlFor:"broker_port",children:"Broker Port"}),(0,r.jsx)(d.I,{id:"broker_port",placeholder:"Broker Port",type:"number",value:v.broker_port,onChange:e=>handleInput("broker_port",Number(e.target.value))}),(0,r.jsxs)(l.z,{onClick:()=>{let n=T.current;if(!n||!n.connected){s.Am.error("MQTT client not connected. Cannot save configuration. \uD83D\uDE14");return}n.publish("mqtt"===e?"mqtt_config/update":"mqtt_config_modbus/update",JSON.stringify(v),t=>{t?s.Am.error("Failed to publish config: ".concat(t.message," \uD83D\uDE2D")):(C(!1),n.publish("service/command",JSON.stringify({action:"restart",services:["mqtt"===e?"mqtt_config.service":"mqtt_modbus.service"]}),e=>{e?s.Am.error("Failed to send restart command: ".concat(e.message," \uD83D\uDE35‍\uD83D\uDCAB")):(s.Am.success("Configuration updated & service restarted. Refreshing data... ✨"),k())}))})},children:[(0,r.jsx)(p.Z,{className:"w-4 h-4 mr-1"})," Save"]})]})]})]})]})]})}function ConfigView(e){let{config:n,onEdit:t}=e;return n?(0,r.jsxs)(c.Zb,{children:[(0,r.jsx)(c.Ol,{children:(0,r.jsx)(c.ll,{children:"MQTT Broker"})}),(0,r.jsxs)(c.aY,{children:[(0,r.jsx)("table",{className:"text-sm w-full",children:(0,r.jsxs)("tbody",{children:[(0,r.jsxs)("tr",{children:[(0,r.jsx)("td",{className:"font-medium pr-4 py-1",children:"Username"}),(0,r.jsx)("td",{className:"py-1",children:n.username||"—"})]}),(0,r.jsxs)("tr",{children:[(0,r.jsx)("td",{className:"font-medium pr-4 py-1",children:"Password"}),(0,r.jsx)("td",{className:"py-1",children:n.password?"••••••":"—"})]}),(0,r.jsxs)("tr",{children:[(0,r.jsx)("td",{className:"font-medium pr-4 py-1",children:"Broker Address"}),(0,r.jsx)("td",{className:"py-1",children:n.broker_address})]}),(0,r.jsxs)("tr",{children:[(0,r.jsx)("td",{className:"font-medium pr-4 py-1",children:"Broker Port"}),(0,r.jsx)("td",{className:"py-1",children:n.broker_port})]})]})}),(0,r.jsxs)(l.z,{className:"mt-4",onClick:t,children:[(0,r.jsx)(p.Z,{className:"w-4 h-4 mr-1"})," Update Configuration"]})]})]}):(0,r.jsxs)(c.Zb,{children:[(0,r.jsx)(c.Ol,{children:(0,r.jsx)(c.ll,{children:"Loading Configuration..."})}),(0,r.jsx)(c.aY,{children:(0,r.jsxs)("p",{className:"text-sm text-muted-foreground flex items-center",children:[(0,r.jsx)(h.Z,{className:"w-4 h-4 mr-2 animate-spin"})," Fetching data..."]})})]})}},6577:function(e,n,t){"use strict";t.d(n,{Z:function(){return MQTTConnectionBadge}});var r=t(7437),o=t(9035),s=t(708),a=t(4530),i=t(4631),c=t(9806),l=t(3715);function MQTTConnectionBadge(){let e=(0,o.w)(),{color:n,icon:t,label:d}=(()=>{switch(e){case"connected":return{color:"bg-green-500",icon:(0,r.jsx)(a.Z,{className:"w-4 h-4 mr-1"}),label:"Connected"};case"disconnected":return{color:"bg-yellow-500",icon:(0,r.jsx)(i.Z,{className:"w-4 h-4 mr-1"}),label:"Disconnected"};case"error":return{color:"bg-red-500",icon:(0,r.jsx)(c.Z,{className:"w-4 h-4 mr-1"}),label:"Error"};default:return{color:"bg-gray-400",icon:(0,r.jsx)(l.Z,{className:"w-4 h-4 mr-1 animate-spin"}),label:"Connecting..."}}})();return(0,r.jsxs)(s.C,{className:"flex items-center ".concat(n," text-white px-2 py-1"),children:[t,(0,r.jsx)("span",{className:"text-sm",children:d})]})}},708:function(e,n,t){"use strict";t.d(n,{C:function(){return Badge}});var r=t(7437);t(2265);var o=t(6061),s=t(1628);let a=(0,o.j)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",info:"border-transparent bg-blue-500 text-white hover:bg-blue-600",success:"border-transparent bg-green-500 text-white hover:bg-green-600",warning:"border-transparent bg-yellow-400 text-yellow-900 hover:bg-yellow-500",outline:"bg-transparent border-foreground text-foreground",outlineInfo:"bg-transparent border-blue-500 text-blue-600",outlineSuccess:"bg-transparent border-green-500 text-green-600",outlineWarning:"bg-transparent border-yellow-400 text-yellow-700",outlineDestructive:"bg-transparent border-destructive text-destructive",gradientInfo:"border-0 bg-gradient-to-r from-blue-400/50 to-blue-600/50 text-blue-900",gradientSuccess:"border-0 bg-gradient-to-r from-green-400/50 to-green-600/50 text-green-900",gradientWarning:"border-0 bg-gradient-to-r from-yellow-300/50 to-yellow-500/50 text-yellow-900",gradientDestructive:"border-0 bg-gradient-to-r from-red-400/50 to-red-600/50 text-red-900"}},defaultVariants:{variant:"default"}});function Badge(e){let{className:n,variant:t,...o}=e;return(0,r.jsx)("div",{className:(0,s.cn)(a({variant:t}),n),...o})}},9598:function(e,n,t){"use strict";t.d(n,{Ol:function(){return i},SZ:function(){return l},Zb:function(){return a},aY:function(){return d},eW:function(){return u},ll:function(){return c}});var r=t(7437),o=t(2265),s=t(1628);let a=o.forwardRef((e,n)=>{let{className:t,...o}=e;return(0,r.jsx)("div",{ref:n,className:(0,s.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",t),...o})});a.displayName="Card";let i=o.forwardRef((e,n)=>{let{className:t,...o}=e;return(0,r.jsx)("div",{ref:n,className:(0,s.cn)("flex flex-col space-y-1.5 p-6",t),...o})});i.displayName="CardHeader";let c=o.forwardRef((e,n)=>{let{className:t,...o}=e;return(0,r.jsx)("div",{ref:n,className:(0,s.cn)("text-2xl font-semibold leading-none tracking-tight",t),...o})});c.displayName="CardTitle";let l=o.forwardRef((e,n)=>{let{className:t,...o}=e;return(0,r.jsx)("div",{ref:n,className:(0,s.cn)("text-sm text-muted-foreground",t),...o})});l.displayName="CardDescription";let d=o.forwardRef((e,n)=>{let{className:t,...o}=e;return(0,r.jsx)("div",{ref:n,className:(0,s.cn)("p-6 pt-0",t),...o})});d.displayName="CardContent";let u=o.forwardRef((e,n)=>{let{className:t,...o}=e;return(0,r.jsx)("div",{ref:n,className:(0,s.cn)("flex items-center p-6 pt-0",t),...o})});u.displayName="CardFooter"},2031:function(e,n,t){"use strict";t.d(n,{$N:function(){return m},Be:function(){return g},Vq:function(){return c},cN:function(){return DialogFooter},cZ:function(){return f},fK:function(){return DialogHeader},hg:function(){return l}});var r=t(7437),o=t(2265),s=t(8712),a=t(2549),i=t(1628);let c=s.fC,l=s.xz,d=s.h_;s.x8;let u=o.forwardRef((e,n)=>{let{className:t,...o}=e;return(0,r.jsx)(s.aV,{ref:n,className:(0,i.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...o})});u.displayName=s.aV.displayName;let f=o.forwardRef((e,n)=>{let{className:t,children:o,...c}=e;return(0,r.jsxs)(d,{children:[(0,r.jsx)(u,{}),(0,r.jsxs)(s.VY,{ref:n,className:(0,i.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",t),...c,children:[o,(0,r.jsxs)(s.x8,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,r.jsx)(a.Z,{className:"h-4 w-4"}),(0,r.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});f.displayName=s.VY.displayName;let DialogHeader=e=>{let{className:n,...t}=e;return(0,r.jsx)("div",{className:(0,i.cn)("flex flex-col space-y-1.5 text-center sm:text-left",n),...t})};DialogHeader.displayName="DialogHeader";let DialogFooter=e=>{let{className:n,...t}=e;return(0,r.jsx)("div",{className:(0,i.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",n),...t})};DialogFooter.displayName="DialogFooter";let m=o.forwardRef((e,n)=>{let{className:t,...o}=e;return(0,r.jsx)(s.Dx,{ref:n,className:(0,i.cn)("text-lg font-semibold leading-none tracking-tight",t),...o})});m.displayName=s.Dx.displayName;let g=o.forwardRef((e,n)=>{let{className:t,...o}=e;return(0,r.jsx)(s.dk,{ref:n,className:(0,i.cn)("text-sm text-muted-foreground",t),...o})});g.displayName=s.dk.displayName},1465:function(e,n,t){"use strict";t.d(n,{_:function(){return l}});var r=t(7437),o=t(2265),s=t(6743),a=t(6061),i=t(1628);let c=(0,a.j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),l=o.forwardRef((e,n)=>{let{className:t,...o}=e;return(0,r.jsx)(s.f,{ref:n,className:(0,i.cn)(c(),t),...o})});l.displayName=s.f.displayName},1750:function(e,n,t){"use strict";t.d(n,{SP:function(){return l},dr:function(){return c},mQ:function(){return i},nU:function(){return d}});var r=t(7437),o=t(2265),s=t(7094),a=t(1628);let i=s.fC,c=o.forwardRef((e,n)=>{let{className:t,...o}=e;return(0,r.jsx)(s.aV,{ref:n,className:(0,a.cn)("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",t),...o})});c.displayName=s.aV.displayName;let l=o.forwardRef((e,n)=>{let{className:t,...o}=e;return(0,r.jsx)(s.xz,{ref:n,className:(0,a.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",t),...o})});l.displayName=s.xz.displayName;let d=o.forwardRef((e,n)=>{let{className:t,...o}=e;return(0,r.jsx)(s.VY,{ref:n,className:(0,a.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",t),...o})});d.displayName=s.VY.displayName},9035:function(e,n,t){"use strict";t.d(n,{w:function(){return useMQTTStatus}});var r=t(2265),o=t(5344);function useMQTTStatus(){let e=(0,o.Oh)(),[n,t]=(0,r.useState)(()=>e?e.connected?"connected":e.disconnected?"disconnected":"connecting":"connecting");return(0,r.useEffect)(()=>{let e=(0,o.kS)();e.connected?t("connected"):e.disconnected?t("disconnected"):t("connecting");let handleConnect=()=>t("connected"),handleError=()=>t("error"),handleClose=()=>t("disconnected"),handleReconnect=()=>t("connecting"),handleOffline=()=>t("disconnected");return e.on("connect",handleConnect),e.on("error",handleError),e.on("close",handleClose),e.on("reconnect",handleReconnect),e.on("offline",handleOffline),()=>{e.off("connect",handleConnect),e.off("error",handleError),e.off("close",handleClose),e.off("reconnect",handleReconnect),e.off("offline",handleOffline)}},[]),n}},5344:function(e,n,t){"use strict";t.d(n,{kS:function(){return connectMQTT},Oh:function(){return getMQTTClient}});var r=t(7406);function getAppConfig(){let e,n;let t=window.location.protocol;if("https:"===t?(e="ws://192.168.0.106:9000",n="http://192.168.0.100:8000"):(e="ws://".concat(window.location.hostname,":9000"),n="http://".concat(window.location.hostname,":8000")),!e)throw Error("MQTT broker URL is not defined.");if(!n)throw Error("API base URL is not defined.");return{mqttBrokerUrl:e,apiBaseUrl:n}}let o=null,s=!1;function connectMQTT(){let{mqttBrokerUrl:e}=getAppConfig();if(!e)throw Error("MQTT broker URL is missing from configuration.");if(o&&(o.connected||s))return o;if(!o||o.disconnected){if(s)return o;s=!0,console.log("MQTT: Attempting connection to ".concat(e,"...")),(o=r.Z.connect(e,{clean:!0,connectTimeout:3e3,reconnectPeriod:1e3})).on("connect",()=>{console.log("MQTT: Connected to ".concat(e)),s=!1}),o.on("error",e=>{console.error("MQTT Error: ".concat(e.message)),s=!1}),o.on("reconnect",()=>{console.log("MQTT: Reconnecting to ".concat(e)),s=!0}),o.on("close",()=>{console.log("MQTT: Connection to ".concat(e," closed.")),s=!1}),o.on("offline",()=>{console.log("MQTT: Client is offline."),s=!1})}return o}function getMQTTClient(){return o}}},function(e){e.O(0,[2793,9848,5348,6107,7721,307,2971,2472,1744],function(){return e(e.s=6435)}),_N_E=e.O()}]);