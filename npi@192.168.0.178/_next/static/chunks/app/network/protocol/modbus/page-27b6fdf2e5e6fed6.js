(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[274],{4530:function(e,t,n){"use strict";n.d(t,{Z:function(){return o}});var r=n(5531);let o=(0,r.Z)("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},3157:function(e,t,n){"use strict";n.d(t,{Z:function(){return o}});var r=n(5531);let o=(0,r.Z)("circle-check",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]])},9806:function(e,t,n){"use strict";n.d(t,{Z:function(){return o}});var r=n(5531);let o=(0,r.Z)("circle-x",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]])},1392:function(e,t,n){"use strict";n.d(t,{Z:function(){return o}});var r=n(5531);let o=(0,r.Z)("network",[["rect",{x:"16",y:"16",width:"6",height:"6",rx:"1",key:"4q2zg0"}],["rect",{x:"2",y:"16",width:"6",height:"6",rx:"1",key:"8cvhb9"}],["rect",{x:"9",y:"2",width:"6",height:"6",rx:"1",key:"1egb70"}],["path",{d:"M5 16v-3a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1v3",key:"1jsf9p"}],["path",{d:"M12 12V8",key:"2874zd"}]])},4280:function(e,t,n){"use strict";n.d(t,{Z:function(){return o}});var r=n(5531);let o=(0,r.Z)("refresh-cw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]])},6245:function(e,t,n){"use strict";n.d(t,{Z:function(){return o}});var r=n(5531);let o=(0,r.Z)("save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]])},4631:function(e,t,n){"use strict";n.d(t,{Z:function(){return o}});var r=n(5531);let o=(0,r.Z)("triangle-alert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]])},8844:function(e,t,n){Promise.resolve().then(n.bind(n,7104))},7104:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return ModbusTCPSettingsPage}});var r=n(7437),o=n(2265),s=n(5831),c=n(3611),a=n(5217),i=n(307),l=n(9598),d=n(3715),u=n(3157),f=n(9806),m=n(1392),g=n(4280),h=n(6245),b=n(5344),p=n(6577),x=n(1424),v=n(6820),y=n.n(v);let C="IOT/Containment/modbustcp/setting/command",w="IOT/Containment/modbustcp/setting/data",j="IOT/Containment/modbustcp/status",T="service/response";function ModbusTCPSettingsPage(){let[e,t]=(0,o.useState)(""),[n,v]=(0,o.useState)(""),[N,M]=(0,o.useState)(""),[k,S]=(0,o.useState)(""),[Z,A]=(0,o.useState)("Unknown"),[P,Q]=(0,o.useState)(!0),E=(0,o.useRef)(null),O=(0,o.useCallback)(()=>{let e=E.current;if(!e||!e.connected){x.Am.warning("MQTT not connected. Cannot retrieve settings."),Q(!1);return}Q(!0),e.publish(C,JSON.stringify({command:"read"}),{},e=>{e?(x.Am.error("Failed to request settings: ".concat(e.message)),console.error("Publish error (read command):",e),Q(!1)):x.Am.info("Requesting Modbus TCP settings...")})},[]),R=(0,o.useCallback)(async(e,t,n)=>{let r=E.current;if(!r||!r.connected){x.Am.error("MQTT not connected. Please wait for connection or refresh.");return}let o=!0;if(n){let e=await y().fire({title:"Are you sure?",text:n,icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, proceed!"});e.isConfirmed||(o=!1,x.Am.info("Action cancelled."))}if(o){let n=JSON.stringify({services:[e],action:t});r.publish("service/command",n,{},n=>{n?(x.Am.error("Failed to send command: ".concat(n.message)),console.error("Publish error (service command):",n)):x.Am.loading("".concat(t.toUpperCase()," ").concat(e," initiated..."),{id:"serviceCommand"})})}},[]);return(0,o.useEffect)(()=>{let e=(0,b.kS)();E.current=e;let n=[w,j,T];n.forEach(t=>{e.subscribe(t,e=>{e&&console.error("Failed to subscribe to ".concat(t,":"),e)})}),e.connected&&O();let handleConnect=()=>{n.forEach(t=>{e.subscribe(t,e=>{e&&console.error("Failed to re-subscribe to ".concat(t," on connect:"),e)})}),O(),x.Am.success("MQTT Connected for Modbus TCP settings. Fetching data...")},handleMessage=(e,n)=>{try{let r=JSON.parse(n.toString());if(e===w){let{modbus_tcp_ip:e,modbus_tcp_port:n}=r;t(e||""),v(String(n||"")),(""===N||N===e)&&M(e||""),(""===k||String(k)===String(n))&&S(String(n||"")),x.Am.success("Modbus TCP settings loaded! \uD83C\uDF89"),Q(!1)}else e===j?A(r.modbusTCPStatus||"Unknown"):e===T&&(x.Am.dismiss("serviceCommand"),"success"===r.result?(y().fire({position:"top-end",icon:"success",title:r.message||"Command executed successfully.",showConfirmButton:!1,timer:3e3,toast:!0}),Array.isArray(r.services)&&r.services.includes("protocol_out.service")&&setTimeout(()=>{O()},1e3)):(y().fire({position:"top-end",icon:"error",title:"Error!",text:r.message||"Command failed.",showConfirmButton:!1,timer:3e3,toast:!0}),console.error("Service command error response:",r)))}catch(e){x.Am.error("Invalid response from MQTT. Check backend payload."),console.error("Error parsing MQTT message:",n.toString(),e),Q(!1)}};return e.on("connect",handleConnect),e.on("message",handleMessage),e.on("error",e=>{console.error("MQTT Client connection error:",e),x.Am.error("MQTT connection error. Please check broker settings."),Q(!1)}),()=>{E.current&&(n.forEach(e=>{var t;null===(t=E.current)||void 0===t||t.unsubscribe(e)}),E.current.off("connect",handleConnect),E.current.off("message",handleMessage),E.current.off("error",()=>{}))}},[O,e,n,N,k]),(0,r.jsxs)(i.kV,{children:[(0,r.jsxs)("header",{className:"flex h-16 items-center justify-between border-b px-4",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(i.vP,{className:"-ml-1"}),(0,r.jsx)(a.Z,{orientation:"vertical",className:"h-4"}),(0,r.jsx)(m.Z,{className:"w-5 h-5 text-primary"}),(0,r.jsx)("h1",{className:"text-lg font-semibold tracking-tight",children:"Modbus TCP Settings"})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(p.Z,{}),(0,r.jsxs)(c.z,{variant:"outline",size:"sm",onClick:O,disabled:P,children:[(0,r.jsx)(g.Z,{className:"w-4 h-4 mr-1"})," Get Current Setting"]})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 p-4",children:[(0,r.jsxs)(l.Zb,{children:[(0,r.jsx)(l.Ol,{children:(0,r.jsx)(l.ll,{children:"Current Configuration"})}),(0,r.jsxs)(l.aY,{className:"space-y-2",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"text-sm font-medium",children:"Modbus IP"}),(0,r.jsx)(s.I,{value:e,readOnly:!0,placeholder:P?"Loading...":"N/A"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"text-sm font-medium",children:"Modbus Port"}),(0,r.jsx)(s.I,{value:n,readOnly:!0,placeholder:P?"Loading...":"N/A"})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("label",{className:"text-sm font-medium",children:"Modbus Status"}),(0,r.jsx)("span",{className:"text-sm",children:Z})]}),(()=>{let t=N===e&&String(k)===n;return P?(0,r.jsxs)("div",{className:"flex items-center gap-2 text-blue-600",children:[(0,r.jsx)(d.Z,{className:"w-4 h-4 animate-spin"}),(0,r.jsx)("span",{children:"Loading configuration..."})]}):e&&n&&t?(0,r.jsxs)("div",{className:"flex items-center gap-2 text-green-600",children:[(0,r.jsx)(u.Z,{className:"w-4 h-4"}),(0,r.jsx)("span",{children:"Configuration matched."})]}):(e||n)&&!t?(0,r.jsxs)("div",{className:"flex items-center gap-2 text-yellow-600",children:[(0,r.jsx)(f.Z,{className:"w-4 h-4"}),(0,r.jsx)("span",{children:"Config mismatch. Save to apply changes."})]}):(0,r.jsx)("div",{className:"flex items-center gap-2 text-muted-foreground",children:(0,r.jsx)("span",{children:"No configuration loaded yet."})})})()]})]}),(0,r.jsxs)(l.Zb,{children:[(0,r.jsx)(l.Ol,{children:(0,r.jsx)(l.ll,{children:"Update Configuration"})}),(0,r.jsxs)(l.aY,{className:"space-y-2",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"text-sm font-medium",children:"Modbus IP"}),(0,r.jsx)(s.I,{value:N,onChange:e=>M(e.target.value),placeholder:"192.168.0.179"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"text-sm font-medium",children:"Modbus Port"}),(0,r.jsx)(s.I,{value:k,onChange:e=>S(e.target.value),placeholder:"502",type:"number"})]}),(0,r.jsxs)(c.z,{className:"mt-4 w-full",onClick:()=>{let e=E.current;if(!e||!e.connected){x.Am.error("MQTT client not connected. Cannot save configuration. \uD83D\uDE14");return}let t=parseInt(k,10);if(isNaN(t)||t<=0||t>65535){x.Am.error("Invalid port number. Port must be a number between 1 and 65535.");return}Q(!0),e.publish(C,JSON.stringify({command:"write",modbus_tcp_ip:N,modbus_tcp_port:t}),{},e=>{e?(x.Am.error("Failed to send write command: ".concat(e.message," \uD83D\uDE2D")),console.error("Publish error (write command):",e),Q(!1)):(x.Am.loading("Configuration sent. Verifying update...",{id:"writeConfigLoading"}),R("protocol_out.service","restart","Modbus TCP settings updated. Do you want to restart the Modbus TCP service to apply changes?"))})},disabled:P,children:[(0,r.jsx)(h.Z,{className:"w-4 h-4 mr-2"})," Save Configuration"]}),(0,r.jsxs)(c.z,{className:"mt-2 w-full",variant:"secondary",onClick:()=>R("protocol_out.service","restart","This will restart the Modbus TCP service. Any ongoing communication will be interrupted. Are you sure?"),disabled:P||!e,children:[(0,r.jsx)(g.Z,{className:"w-4 h-4 mr-2"})," Restart Modbus TCP Service"]})]})]})]})]})}},6577:function(e,t,n){"use strict";n.d(t,{Z:function(){return MQTTConnectionBadge}});var r=n(7437),o=n(9035),s=n(708),c=n(4530),a=n(4631),i=n(9806),l=n(3715);function MQTTConnectionBadge(){let e=(0,o.w)(),{color:t,icon:n,label:d}=(()=>{switch(e){case"connected":return{color:"bg-green-500",icon:(0,r.jsx)(c.Z,{className:"w-4 h-4 mr-1"}),label:"Connected"};case"disconnected":return{color:"bg-yellow-500",icon:(0,r.jsx)(a.Z,{className:"w-4 h-4 mr-1"}),label:"Disconnected"};case"error":return{color:"bg-red-500",icon:(0,r.jsx)(i.Z,{className:"w-4 h-4 mr-1"}),label:"Error"};default:return{color:"bg-gray-400",icon:(0,r.jsx)(l.Z,{className:"w-4 h-4 mr-1 animate-spin"}),label:"Connecting..."}}})();return(0,r.jsxs)(s.C,{className:"flex items-center ".concat(t," text-white px-2 py-1"),children:[n,(0,r.jsx)("span",{className:"text-sm",children:d})]})}},708:function(e,t,n){"use strict";n.d(t,{C:function(){return Badge}});var r=n(7437);n(2265);var o=n(6061),s=n(1628);let c=(0,o.j)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",info:"border-transparent bg-blue-500 text-white hover:bg-blue-600",success:"border-transparent bg-green-500 text-white hover:bg-green-600",warning:"border-transparent bg-yellow-400 text-yellow-900 hover:bg-yellow-500",outline:"bg-transparent border-foreground text-foreground",outlineInfo:"bg-transparent border-blue-500 text-blue-600",outlineSuccess:"bg-transparent border-green-500 text-green-600",outlineWarning:"bg-transparent border-yellow-400 text-yellow-700",outlineDestructive:"bg-transparent border-destructive text-destructive",gradientInfo:"border-0 bg-gradient-to-r from-blue-400/50 to-blue-600/50 text-blue-900",gradientSuccess:"border-0 bg-gradient-to-r from-green-400/50 to-green-600/50 text-green-900",gradientWarning:"border-0 bg-gradient-to-r from-yellow-300/50 to-yellow-500/50 text-yellow-900",gradientDestructive:"border-0 bg-gradient-to-r from-red-400/50 to-red-600/50 text-red-900"}},defaultVariants:{variant:"default"}});function Badge(e){let{className:t,variant:n,...o}=e;return(0,r.jsx)("div",{className:(0,s.cn)(c({variant:n}),t),...o})}},9598:function(e,t,n){"use strict";n.d(t,{Ol:function(){return a},SZ:function(){return l},Zb:function(){return c},aY:function(){return d},eW:function(){return u},ll:function(){return i}});var r=n(7437),o=n(2265),s=n(1628);let c=o.forwardRef((e,t)=>{let{className:n,...o}=e;return(0,r.jsx)("div",{ref:t,className:(0,s.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",n),...o})});c.displayName="Card";let a=o.forwardRef((e,t)=>{let{className:n,...o}=e;return(0,r.jsx)("div",{ref:t,className:(0,s.cn)("flex flex-col space-y-1.5 p-6",n),...o})});a.displayName="CardHeader";let i=o.forwardRef((e,t)=>{let{className:n,...o}=e;return(0,r.jsx)("div",{ref:t,className:(0,s.cn)("text-2xl font-semibold leading-none tracking-tight",n),...o})});i.displayName="CardTitle";let l=o.forwardRef((e,t)=>{let{className:n,...o}=e;return(0,r.jsx)("div",{ref:t,className:(0,s.cn)("text-sm text-muted-foreground",n),...o})});l.displayName="CardDescription";let d=o.forwardRef((e,t)=>{let{className:n,...o}=e;return(0,r.jsx)("div",{ref:t,className:(0,s.cn)("p-6 pt-0",n),...o})});d.displayName="CardContent";let u=o.forwardRef((e,t)=>{let{className:n,...o}=e;return(0,r.jsx)("div",{ref:t,className:(0,s.cn)("flex items-center p-6 pt-0",n),...o})});u.displayName="CardFooter"},9035:function(e,t,n){"use strict";n.d(t,{w:function(){return useMQTTStatus}});var r=n(2265),o=n(5344);function useMQTTStatus(){let e=(0,o.Oh)(),[t,n]=(0,r.useState)(()=>e?e.connected?"connected":e.disconnected?"disconnected":"connecting":"connecting");return(0,r.useEffect)(()=>{let e=(0,o.kS)();e.connected?n("connected"):e.disconnected?n("disconnected"):n("connecting");let handleConnect=()=>n("connected"),handleError=()=>n("error"),handleClose=()=>n("disconnected"),handleReconnect=()=>n("connecting"),handleOffline=()=>n("disconnected");return e.on("connect",handleConnect),e.on("error",handleError),e.on("close",handleClose),e.on("reconnect",handleReconnect),e.on("offline",handleOffline),()=>{e.off("connect",handleConnect),e.off("error",handleError),e.off("close",handleClose),e.off("reconnect",handleReconnect),e.off("offline",handleOffline)}},[]),t}},5344:function(e,t,n){"use strict";n.d(t,{kS:function(){return connectMQTT},Oh:function(){return getMQTTClient}});var r=n(7406);function getAppConfig(){let e,t;let n=window.location.protocol;if("https:"===n?(e="ws://192.168.0.106:9000",t="http://192.168.0.100:8000"):(e="ws://".concat(window.location.hostname,":9000"),t="http://".concat(window.location.hostname,":8000")),!e)throw Error("MQTT broker URL is not defined.");if(!t)throw Error("API base URL is not defined.");return{mqttBrokerUrl:e,apiBaseUrl:t}}let o=null,s=!1;function connectMQTT(){let{mqttBrokerUrl:e}=getAppConfig();if(!e)throw Error("MQTT broker URL is missing from configuration.");if(o&&(o.connected||s))return o;if(!o||o.disconnected){if(s)return o;s=!0,console.log("MQTT: Attempting connection to ".concat(e,"...")),(o=r.Z.connect(e,{clean:!0,connectTimeout:3e3,reconnectPeriod:1e3})).on("connect",()=>{console.log("MQTT: Connected to ".concat(e)),s=!1}),o.on("error",e=>{console.error("MQTT Error: ".concat(e.message)),s=!1}),o.on("reconnect",()=>{console.log("MQTT: Reconnecting to ".concat(e)),s=!0}),o.on("close",()=>{console.log("MQTT: Connection to ".concat(e," closed.")),s=!1}),o.on("offline",()=>{console.log("MQTT: Client is offline."),s=!1})}return o}function getMQTTClient(){return o}}},function(e){e.O(0,[2793,9461,9848,5348,6107,307,2971,2472,1744],function(){return e(e.s=8844)}),_N_E=e.O()}]);