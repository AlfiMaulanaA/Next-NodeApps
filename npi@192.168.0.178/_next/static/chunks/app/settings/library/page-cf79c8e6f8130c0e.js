(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3353],{8520:function(e,r,t){Promise.resolve().then(t.bind(t,8382))},8382:function(e,r,t){"use strict";t.r(r),t.d(r,{default:function(){return FileLibraryPage}});var a=t(7437),s=t(2265),n=t(1424),l=t(3611),i=t(9598),d=t(5217),c=t(307),o=t(9209),u=t(3086),m=t(1827),h=t(9883),p=t(4737),f=t(2549),x=t(3715),g=t(3116),v=t(4056),b=t(1541),j=t(5817),N=t(5831),y=t(1465),w=t(5344),_=t(7532),C=t(1750),T=t(2031),S=t(6577),A=t(6820),D=t.n(A);let I="library/devices/summary",M="library/devices/summary/search/response",R="library/devices/command",P="library/devices/command/response",U="library/devices/edit/load/response";function FileLibraryPage(){let[e,r]=(0,s.useState)("disconnected"),[t,A]=(0,s.useState)(null),k=(0,s.useRef)(null),[Q,F]=(0,s.useState)({}),[O,V]=(0,s.useState)(""),[B,Z]=(0,s.useState)(""),[L,E]=(0,s.useState)(""),[z,q]=(0,s.useState)(""),[H,Y]=(0,s.useState)(""),[J,W]=(0,s.useState)(""),[G,$]=(0,s.useState)(null),[K,X]=(0,s.useState)(""),[ee,er]=(0,s.useState)(""),[et,ea]=(0,s.useState)(""),[es,en]=(0,s.useState)(""),[el,ei]=(0,s.useState)([]),[ed,ec]=(0,s.useState)(""),[eo,eu]=(0,s.useState)(""),[em,eh]=(0,s.useState)(""),[ep,ef]=(0,s.useState)(""),[ex,eg]=(0,s.useState)([]),[ev,eb]=(0,s.useState)(null),[ej,eN]=(0,s.useState)(!1),[ey,ew]=(0,s.useState)(!1),[e_,eC]=(0,s.useState)(!1),eT=(0,s.useMemo)(()=>Object.keys(Q).sort(),[Q]),eS=(0,s.useMemo)(()=>{let e=["ups","rectifier","battery","pdu"],r=["power_meter","switch","pfc"],t=["aircond"],a=["Controller"],s=["environment","water","Sensor_RS485"],n={"Power Systems":e,Monitoring:r,Cooling:t,Control:a,Sensors:s,Others:[]},l=[...e,...r,...t,...a,...s];return n.Others=eT.filter(e=>!l.includes(e)),n},[eT]),eA=(0,s.useMemo)(()=>{if(!ed||!Q[ed])return[];let e=new Set;return Q[ed].forEach(r=>{e.add(r.manufacturer)}),Array.from(e).sort()},[ed,Q]),eD=(0,s.useMemo)(()=>{if(!ed||!eo||!Q[ed])return[];let e=new Set;return Q[ed].filter(e=>e.manufacturer===eo).forEach(r=>{e.add(r.part_number)}),Array.from(e).sort()},[ed,eo,Q]),eI=(0,s.useMemo)(()=>{if(!ed||!eo||!em||!Q[ed])return[];let e=new Set;return Q[ed].filter(e=>e.manufacturer===eo&&e.part_number===em).forEach(r=>{e.add(r.protocol)}),Array.from(e).sort()},[ed,eo,em,Q]),restartService=()=>{if(!k.current||!k.current.connected){n.Am.error("MQTT not connected. Cannot restart service.");return}let e=JSON.stringify({action:"restart",services:["MODBUS_SNMP.service"]});k.current.publish("service/command",e,e=>{e?(n.Am.error("Failed to send restart command: ".concat(e.message),{id:"restartToast"}),console.error("Publish error:",e)):n.Am.loading("Restarting MODBUS_SNMP.service...",{id:"restartToast"})})};(0,s.useEffect)(()=>{let e=(0,w.kS)();k.current=e;let handleConnect=()=>{r("connected"),e.subscribe("response_file_transfer"),e.subscribe("service/response"),e.subscribe("download_file_response"),e.subscribe(I),e.subscribe(M),e.subscribe(P),e.subscribe(U),n.Am.success("Connected to MQTT Broker."),D().fire({icon:"success",title:"Connected!",text:"Successfully connected to MQTT Broker",position:"top-end",timer:2e3,timerProgressBar:!0,showConfirmButton:!1,toast:!0})},handleError=e=>{console.error("MQTT Client Error:",e),r("error"),n.Am.error("MQTT Error: ".concat(e.message))},handleClose=()=>{r("disconnected"),n.Am.warning("Disconnected from MQTT Broker.")},handleMessage=(e,r)=>{try{let c=JSON.parse(r.toString());if("response_file_transfer"===e)"success"===c.status&&"upload"===c.action?(n.Am.success("devices.json uploaded successfully."),D().fire({icon:"success",title:"Upload Successful!",text:"devices.json has been uploaded successfully",position:"top-end",timer:3e3,timerProgressBar:!0,showConfirmButton:!1,toast:!0}),k.current?restartService():console.warn("ClientRef is null when trying to restart service after upload success.")):"error"===c.status&&(n.Am.error(c.message||"Upload failed"),console.error("File upload error response:",c));else if("service/response"===e)"success"===c.result?(n.Am.success(c.message||"Service restarted successfully."),D().fire({icon:"success",title:"Service Restarted!",text:c.message||"MODBUS_SNMP service restarted successfully",position:"top-end",timer:3e3,timerProgressBar:!0,showConfirmButton:!1,toast:!0})):(n.Am.error(c.message||"Service restart failed."),console.error("Service restart error response:",c));else if("download_file_response"===e){if("success"===c.status&&"download"===c.action&&c.content){let e=new Blob([atob(c.content)],{type:"application/json"}),r=URL.createObjectURL(e),t=document.createElement("a");t.href=r,t.download="devices.json",document.body.appendChild(t),t.click(),document.body.removeChild(t),URL.revokeObjectURL(r),n.Am.success("devices.json downloaded successfully."),D().fire({icon:"success",title:"Download Complete!",text:"devices.json has been downloaded successfully",position:"top-end",timer:3e3,timerProgressBar:!0,showConfirmButton:!1,toast:!0})}else"error"===c.status&&(n.Am.error(c.message||"Download failed"),console.error("File download error response:",c))}else if(e===I)F(c);else if(e===M){if("success"===c.status&&c.data){if(ej){if(eb(c.data),console.log("Loading device data for update:",c.data),c.data.data&&Array.isArray(c.data.data)){let e=c.data.data.filter(e=>e&&"object"==typeof e).map(e=>{let r=e.data_type||"UINT16";return"UINT3T16"===r&&(r="UINT16"),"INve_address"===r&&(r="INT16"),["UINT16","INT16","UINT32","INT32","FLOAT32","BOOLEAN"].includes(r)||(r="UINT16"),{var_name:e.var_name||"",relative_address:"number"==typeof e.relative_address?e.relative_address:e.relative_address||"",register_type:e.register_type||"Holding Register",word_length:Number(e.word_length)||1,data_type:r,multiplier:Number(e.multiplier)||1}});console.log("Processed variables for update:",e),eg(e)}else console.log("No device data array found, setting empty array"),eg([]);eN(!1),n.Am.success("Device data loaded for editing!",{id:"loadDeviceToast"}),D().fire({icon:"success",title:"Device Loaded!",text:"".concat(c.data.manufacturer," ").concat(c.data.part_number," data loaded for editing"),position:"top-end",timer:3e3,timerProgressBar:!0,showConfirmButton:!1,toast:!0})}else $(c),n.Am.success("Device found!"),D().fire({icon:"success",title:"Device Found!",text:"Found ".concat(c.data.manufacturer," ").concat(c.data.part_number),position:"top-end",timer:3e3,timerProgressBar:!0,showConfirmButton:!1,toast:!0})}else eN(!1),ej||$(c),n.Am.info(c.message||"Device not found.")}else if(e===U){if(console.log("Edit load response received:",c),"success"===c.status&&c.data){if(eb(c.data),c.data.data&&Array.isArray(c.data.data)){let e=c.data.data.filter(e=>e&&"object"==typeof e).map(e=>{let r=e.data_type||"UINT16";return"UINT3T16"===r&&(r="UINT16"),"INve_address"===r&&(r="INT16"),["UINT16","INT16","UINT32","INT32","FLOAT32","BOOLEAN"].includes(r)||(r="UINT16"),{var_name:e.var_name||"",relative_address:"number"==typeof e.relative_address?e.relative_address:e.relative_address||"",register_type:e.register_type||"Holding Register",word_length:Number(e.word_length)||1,data_type:r,multiplier:Number(e.multiplier)||1}});console.log("Processed variables for edit:",e),eg(e)}else console.log("No device data array found, setting empty array"),eg([]);eN(!1),ew(!1),n.Am.success("Device data loaded for editing!",{id:"loadDeviceToast"}),D().fire({icon:"success",title:"Device Loaded for Edit!",text:"".concat(c.data.manufacturer," ").concat(c.data.part_number," data loaded successfully"),position:"top-end",timer:3e3,timerProgressBar:!0,showConfirmButton:!1,toast:!0})}else eN(!1),ew(!1),n.Am.error(c.message||"Failed to load device data for editing.")}else if(e===P){if("success"===c.status){var t,a,s,l,i,d;n.Am.success(c.message||"Command executed successfully.");let e=(null===(t=c.message)||void 0===t?void 0:t.includes("Section"))&&(null===(a=c.message)||void 0===a?void 0:a.includes("created"))?"Section Created":(null===(s=c.message)||void 0===s?void 0:s.includes("Section"))&&(null===(l=c.message)||void 0===l?void 0:l.includes("deleted"))?"Section Deleted":(null===(i=c.message)||void 0===i?void 0:i.includes("Device"))&&(null===(d=c.message)||void 0===d?void 0:d.includes("added"))?"Device Added":"Operation Successful";D().fire({icon:"success",title:e,text:c.message||"Command executed successfully",position:"top-end",timer:3e3,timerProgressBar:!0,showConfirmButton:!1,toast:!0})}else n.Am.error(c.message||"Command failed."),console.error("Library command error response:",c)}}catch(e){n.Am.error("Invalid payload format received from MQTT."),console.error("MQTT message parsing error:",e)}};return e.on("connect",handleConnect),e.on("error",handleError),e.on("close",handleClose),e.on("message",handleMessage),()=>{e.connected&&(e.unsubscribe("response_file_transfer"),e.unsubscribe("service/response"),e.unsubscribe("download_file_response"),e.unsubscribe(I),e.unsubscribe(M),e.unsubscribe(P),e.unsubscribe(U)),e.off("connect",handleConnect),e.off("error",handleError),e.off("close",handleClose),e.off("message",handleMessage)}},[]);let downloadFile=()=>{if(!k.current||!k.current.connected){n.Am.error("MQTT not connected. Cannot download file.");return}n.Am.loading("Requesting devices.json download...",{id:"downloadToast"});let e=JSON.stringify({action:"download",filepath:"../MODBUS_SNMP/JSON/Config/Library/devices.json"});k.current.publish("command_download_file",e,e=>{e&&(n.Am.error("Failed to send download command: ".concat(e.message),{id:"downloadToast"}),console.error("Publish error:",e))})},uploadFile=e=>{if(!k.current||!k.current.connected){n.Am.error("MQTT not connected. Cannot upload file.");return}let r=new FileReader;r.onload=()=>{var e;let t=btoa(r.result),a=JSON.stringify({action:"upload",filepath:"../MODBUS_SNMP/JSON/Config/Library/devices.json",content:t});null===(e=k.current)||void 0===e||e.publish("command_upload_file",a,e=>{e?(n.Am.error("Failed to send upload command: ".concat(e.message),{id:"uploadToast"}),console.error("Publish error:",e)):n.Am.loading("Uploading devices.json...",{id:"uploadToast"})})},r.onerror=()=>{n.Am.error("Failed to read file.")},r.readAsBinaryString(e)},handleRemoveDeviceVariable=e=>{ei(r=>r.filter((r,t)=>t!==e))},handleDeviceVariableChange=(e,r,t)=>{ei(a=>a.map((a,s)=>s===e?{...a,[r]:t}:a))},handleRemoveUpdateDeviceVariable=e=>{eg(r=>r.filter((r,t)=>t!==e))},handleUpdateDeviceVariableChange=(e,r,t)=>{eg(a=>a.map((a,s)=>s===e?{...a,[r]:t}:a))};return(0,a.jsxs)(c.kV,{children:[(0,a.jsxs)("header",{className:"flex h-16 items-center justify-between border-b px-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(c.vP,{className:"-ml-1"}),(0,a.jsx)(d.Z,{orientation:"vertical",className:"mr-2 h-4"}),(0,a.jsx)(o.Z,{className:"h-5 w-5"}),(0,a.jsx)("h1",{className:"text-lg font-semibold",children:"File Library Management"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(S.Z,{}),(0,a.jsx)(l.z,{variant:"outline",size:"icon",className:"h-8 w-8",onClick:()=>{n.Am.info("Refreshing page for MQTT connection re-initialization..."),window.location.reload()},children:(0,a.jsx)(u.Z,{className:"w-4 h-4"})})]})]}),(0,a.jsx)("div",{className:"p-6",children:(0,a.jsxs)(C.mQ,{defaultValue:"library",className:"w-full",children:[(0,a.jsxs)(C.dr,{className:"grid w-full grid-cols-5",children:[(0,a.jsx)(C.SP,{value:"library",children:"Device Library"}),(0,a.jsx)(C.SP,{value:"search",children:"Search Devices"}),(0,a.jsx)(C.SP,{value:"manage",children:"Manage Library"}),(0,a.jsx)(C.SP,{value:"update",children:"Update Device"}),(0,a.jsx)(C.SP,{value:"files",children:"File Operations"})]}),(0,a.jsx)(C.nU,{value:"library",className:"space-y-6 mt-6",children:(0,a.jsxs)(i.Zb,{children:[(0,a.jsx)(i.Ol,{children:(0,a.jsx)(i.ll,{className:"text-base",children:"Device Library Summary"})}),(0,a.jsxs)(i.aY,{children:[Object.keys(Q).length>0?(0,a.jsxs)(C.mQ,{defaultValue:"Power Systems",className:"w-full",children:[(0,a.jsx)(C.dr,{className:"grid w-full grid-cols-6",children:Object.keys(eS).map(e=>(0,a.jsx)(C.SP,{value:e,className:"text-xs",children:e},e))}),Object.entries(eS).map(e=>{let[r,t]=e;return(0,a.jsx)(C.nU,{value:r,className:"mt-4",children:(0,a.jsx)("div",{className:"max-h-80 overflow-y-auto space-y-4",children:t.length>0?t.filter(e=>Q[e]).map(e=>{let r=Q[e];return(0,a.jsxs)("div",{className:"border rounded-md p-3 bg-muted",children:[(0,a.jsxs)("h3",{className:"font-semibold text-lg capitalize mb-2",children:[e.replace(/_/g," ")," (",Array.isArray(r)?r.length:0," devices)"]}),(0,a.jsx)("ul",{className:"list-disc pl-5 space-y-1 text-sm",children:Array.isArray(r)?r.map((r,t)=>(0,a.jsxs)("li",{children:[(0,a.jsx)("strong",{className:"text-primary",children:r.manufacturer})," - ",r.part_number," (",(0,a.jsx)("span",{className:"text-blue-600",children:r.protocol}),")"]},"".concat(e,"-").concat(r.part_number,"-").concat(t))):(0,a.jsx)("li",{className:"text-red-500",children:"Error: Invalid data format for this section. Expected an array of devices."})})]},e)}):(0,a.jsx)("p",{className:"text-muted-foreground text-sm text-center py-8",children:"No devices available in this category."})})},r)})]}):(0,a.jsxs)("p",{className:"text-muted-foreground text-sm",children:["No device summary available or loading... Ensure the backend service is running and publishing updates to `",I,"`."]}),(0,a.jsxs)(l.z,{onClick:()=>{},className:"mt-4",variant:"outline",size:"sm",disabled:!0,children:[(0,a.jsx)(u.Z,{className:"mr-2 h-4 w-4"})," Summary updates periodically"]})]})]})}),(0,a.jsx)(C.nU,{value:"search",className:"space-y-6 mt-6",children:(0,a.jsxs)(i.Zb,{children:[(0,a.jsx)(i.Ol,{children:(0,a.jsx)(i.ll,{className:"text-base",children:"Search Device"})}),(0,a.jsxs)(i.aY,{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(y._,{htmlFor:"search-section",children:"Section (Required)"}),(0,a.jsx)(N.I,{id:"search-section",value:L,onChange:e=>E(e.target.value),placeholder:"e.g., Modbus TCP",disabled:"connected"!==e})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(y._,{htmlFor:"search-manufacturer",children:"Manufacturer"}),(0,a.jsx)(N.I,{id:"search-manufacturer",value:z,onChange:e=>q(e.target.value),placeholder:"e.g., Siemens",disabled:"connected"!==e})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(y._,{htmlFor:"search-part-number",children:"Part Number"}),(0,a.jsx)(N.I,{id:"search-part-number",value:H,onChange:e=>Y(e.target.value),placeholder:"e.g., S7-1200",disabled:"connected"!==e})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(y._,{htmlFor:"search-protocol",children:"Protocol"}),(0,a.jsx)(N.I,{id:"search-protocol",value:J,onChange:e=>W(e.target.value),placeholder:"e.g., MODBUS_TCP",disabled:"connected"!==e})]})]}),(0,a.jsxs)(l.z,{onClick:()=>{if(!k.current||!k.current.connected){n.Am.error("MQTT not connected. Cannot search device.");return}if(!L.trim()){n.Am.error("Section is required for device search.");return}let e={section:L.trim()};z.trim()&&(e.manufacturer=z.trim()),H.trim()&&(e.part_number=H.trim()),J.trim()&&(e.protocol=J.trim());let r=JSON.stringify({command:"Get Data",search_params:e});k.current.publish("library/devices/summary/search",r,e=>{e?(n.Am.error("Failed to send search command: ".concat(e.message)),console.error("Publish error:",e)):(n.Am.loading("Searching for device...",{id:"searchDeviceToast"}),$(null))})},disabled:"connected"!==e||!L.trim(),children:[(0,a.jsx)(m.Z,{className:"mr-2 h-4 w-4"})," Search Device"]}),G&&(0,a.jsxs)("div",{className:"mt-4",children:[(0,a.jsx)("h3",{className:"text-md font-semibold mb-2",children:"Search Result:"}),"success"===G.status&&G.data?(0,a.jsx)("div",{className:"bg-muted p-3 rounded-md text-sm max-h-40 overflow-y-auto",children:G.data.manufacturer&&G.data.part_number?(0,a.jsxs)("div",{className:"mb-2",children:[(0,a.jsx)("h4",{className:"font-medium capitalize text-base mb-3",children:"Found Device:"}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Manufacturer:"})," ",G.data.manufacturer]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Part Number:"})," ",G.data.part_number]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Protocol:"})," ",G.data.protocol]}),G.data.data&&Array.isArray(G.data.data)&&G.data.data.length>0&&(0,a.jsxs)("div",{className:"mt-3",children:[(0,a.jsx)("p",{className:"font-medium mb-2",children:"Device Variables:"}),(0,a.jsx)("div",{className:"bg-secondary p-2 rounded-sm max-h-32 overflow-y-auto",children:(0,a.jsx)("ul",{className:"space-y-1",children:G.data.data.map((e,r)=>(0,a.jsx)("li",{className:"text-xs border-b border-border/20 pb-1 last:border-b-0",children:(0,a.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,a.jsxs)("span",{children:[(0,a.jsx)("strong",{children:"Name:"})," ",e.var_name||"N/A"]}),(0,a.jsxs)("span",{children:[(0,a.jsx)("strong",{children:"Address:"})," ",e.relative_address||"N/A"]}),(0,a.jsxs)("span",{children:[(0,a.jsx)("strong",{children:"Type:"})," ",e.register_type||"N/A"]}),(0,a.jsxs)("span",{children:[(0,a.jsx)("strong",{children:"Data Type:"})," ",e.data_type||"N/A"]}),(0,a.jsxs)("span",{children:[(0,a.jsx)("strong",{children:"Length:"})," ",e.word_length||"N/A"]}),(0,a.jsxs)("span",{children:[(0,a.jsx)("strong",{children:"Multiplier:"})," ",e.multiplier||"N/A"]})]})},r))})})]}),G.data.uom&&(0,a.jsx)("div",{className:"mt-2",children:(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"UOM:"})," ",G.data.uom]})})]})]}):(0,a.jsx)("p",{className:"text-muted-foreground",children:"No specific device data found in the successful response."})}):(0,a.jsx)("p",{className:"text-muted-foreground text-sm",children:G.message||"No results found or error occurred."})]})]})]})}),(0,a.jsxs)(C.nU,{value:"manage",className:"space-y-6 mt-6",children:[(0,a.jsxs)(i.Zb,{children:[(0,a.jsx)(i.Ol,{children:(0,a.jsx)(i.ll,{className:"text-base",children:"Manage Sections"})}),(0,a.jsxs)(i.aY,{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(y._,{htmlFor:"new-section-name",className:"mb-2 block",children:"Create New Section"}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(N.I,{id:"new-section-name",placeholder:"Enter new section name (e.g., Modbus RTU)",value:O,onChange:e=>V(e.target.value),disabled:"connected"!==e}),(0,a.jsxs)(l.z,{onClick:()=>{if(!k.current||!k.current.connected){n.Am.error("MQTT not connected. Cannot create section.");return}if(!O.trim()){n.Am.error("Section name cannot be empty.");return}let e=JSON.stringify({command:"Create New Section",data:O.trim()});k.current.publish(R,e,e=>{e?(n.Am.error("Failed to send create section command: ".concat(e.message)),console.error("Publish error:",e)):(n.Am.loading("Creating new section...",{id:"createSectionToast"}),V(""))})},disabled:"connected"!==e||!O.trim(),children:[(0,a.jsx)(h.Z,{className:"mr-2 h-4 w-4"})," Create"]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(y._,{htmlFor:"delete-section-select",className:"mb-2 block",children:"Delete Section"}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)(_.Ph,{value:B,onValueChange:Z,disabled:"connected"!==e,children:[(0,a.jsx)(_.i4,{id:"delete-section-select",children:(0,a.jsx)(_.ki,{placeholder:"Select section to delete"})}),(0,a.jsx)(_.Bw,{children:eT.length>0?eT.map(e=>(0,a.jsx)(_.Ql,{value:e,children:e.replace(/_/g," ")},e)):(0,a.jsx)(_.Ql,{value:"no-sections-available",disabled:!0,children:"No sections available"})})]}),(0,a.jsxs)(l.z,{variant:"destructive",onClick:()=>{if(!k.current||!k.current.connected){n.Am.error("MQTT not connected. Cannot delete section.");return}if(!B.trim()){n.Am.error("Section name to delete cannot be empty.");return}if(!confirm('Are you sure you want to delete section "'.concat(B,'"? This action cannot be undone.')))return;let e=JSON.stringify({command:"Delete Section",data:B.trim()});k.current.publish(R,e,e=>{e?(n.Am.error("Failed to send delete section command: ".concat(e.message)),console.error("Publish error:",e)):(n.Am.loading("Deleting section...",{id:"deleteSectionToast"}),Z(""))})},disabled:"connected"!==e||!B.trim(),children:[(0,a.jsx)(p.Z,{className:"mr-2 h-4 w-4"})," Delete"]})]})]})]})]}),(0,a.jsxs)(i.Zb,{children:[(0,a.jsx)(i.Ol,{children:(0,a.jsx)(i.ll,{className:"text-base",children:"Add New Device"})}),(0,a.jsxs)(i.aY,{className:"space-y-4",children:[(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Add a new device by providing its details and custom data variables."}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(y._,{htmlFor:"new-device-section",children:"Section (Required)"}),(0,a.jsxs)(_.Ph,{value:K,onValueChange:X,disabled:"connected"!==e,children:[(0,a.jsx)(_.i4,{id:"new-device-section",children:(0,a.jsx)(_.ki,{placeholder:"Select existing section"})}),(0,a.jsx)(_.Bw,{children:eT.length>0?eT.map(e=>(0,a.jsx)(_.Ql,{value:e,children:e.replace(/_/g," ")},e)):(0,a.jsx)(_.Ql,{value:"no-sections-available",disabled:!0,children:"No sections available. Create one first."})})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(y._,{htmlFor:"new-device-manufacturer",children:"Manufacturer (Required)"}),(0,a.jsx)(N.I,{id:"new-device-manufacturer",value:ee,onChange:e=>er(e.target.value),placeholder:"e.g., Schneider Electric",disabled:"connected"!==e})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(y._,{htmlFor:"new-device-part-number",children:"Part Number (Required)"}),(0,a.jsx)(N.I,{id:"new-device-part-number",value:et,onChange:e=>ea(e.target.value),placeholder:"e.g., TM221CE16R",disabled:"connected"!==e})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(y._,{htmlFor:"new-device-protocol",children:"Protocol (Required)"}),(0,a.jsx)(N.I,{id:"new-device-protocol",value:es,onChange:e=>en(e.target.value),placeholder:"e.g., MODBUS_TCP",disabled:"connected"!==e})]})]}),(0,a.jsxs)("div",{className:"space-y-3 p-4 border rounded-md bg-secondary/20",children:[(0,a.jsx)("div",{className:"flex justify-between items-center mb-2",children:(0,a.jsx)(y._,{className:"text-base font-semibold",children:"Device Data Variables"})}),0===el.length&&(0,a.jsx)("p",{className:"text-muted-foreground text-sm",children:'Click "Add Variable" to define data points for this device.'}),el.map((r,t)=>(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-3 border p-3 rounded-md bg-background relative",children:[(0,a.jsx)(l.z,{onClick:()=>handleRemoveDeviceVariable(t),type:"button",variant:"ghost",size:"icon",className:"absolute top-2 right-2 h-6 w-6 text-muted-foreground hover:text-red-500",disabled:"connected"!==e,children:(0,a.jsx)(f.Z,{className:"h-4 w-4"})}),(0,a.jsxs)("div",{className:"md:col-span-1",children:[(0,a.jsx)(y._,{htmlFor:"var_name-".concat(t),children:"Var Name"}),(0,a.jsx)(N.I,{id:"var_name-".concat(t),value:r.var_name,onChange:e=>handleDeviceVariableChange(t,"var_name",e.target.value),placeholder:"e.g., Status word frequency",disabled:"connected"!==e})]}),(0,a.jsxs)("div",{className:"md:col-span-1",children:[(0,a.jsx)(y._,{htmlFor:"relative_address-".concat(t),children:"Relative Address"}),(0,a.jsx)(N.I,{id:"relative_address-".concat(t),type:"number",value:r.relative_address,onChange:e=>handleDeviceVariableChange(t,"relative_address",""===e.target.value?"":parseInt(e.target.value,10)),placeholder:"e.g., 3201",disabled:"connected"!==e})]}),(0,a.jsxs)("div",{className:"md:col-span-1",children:[(0,a.jsx)(y._,{htmlFor:"register_type-".concat(t),children:"Register Type"}),(0,a.jsxs)(_.Ph,{value:r.register_type,onValueChange:e=>handleDeviceVariableChange(t,"register_type",e),disabled:"connected"!==e,children:[(0,a.jsx)(_.i4,{id:"register_type-".concat(t),children:(0,a.jsx)(_.ki,{placeholder:"Select type"})}),(0,a.jsxs)(_.Bw,{children:[(0,a.jsx)(_.Ql,{value:"Holding Register",children:"Holding Register"}),(0,a.jsx)(_.Ql,{value:"Input Register",children:"Input Register"}),(0,a.jsx)(_.Ql,{value:"Coil",children:"Coil"}),(0,a.jsx)(_.Ql,{value:"Discrete Input",children:"Discrete Input"})]})]})]}),(0,a.jsxs)("div",{className:"md:col-span-1",children:[(0,a.jsx)(y._,{htmlFor:"word_length-".concat(t),children:"Word Length"}),(0,a.jsx)(N.I,{id:"word_length-".concat(t),type:"number",value:r.word_length,onChange:e=>handleDeviceVariableChange(t,"word_length",parseInt(e.target.value,10)),placeholder:"e.g., 1",disabled:"connected"!==e})]}),(0,a.jsxs)("div",{className:"md:col-span-1",children:[(0,a.jsx)(y._,{htmlFor:"data_type-".concat(t),children:"Data Type"}),(0,a.jsxs)(_.Ph,{value:r.data_type,onValueChange:e=>handleDeviceVariableChange(t,"data_type",e),disabled:"connected"!==e,children:[(0,a.jsx)(_.i4,{id:"data_type-".concat(t),children:(0,a.jsx)(_.ki,{placeholder:"Select type"})}),(0,a.jsxs)(_.Bw,{children:[(0,a.jsx)(_.Ql,{value:"UINT16",children:"UINT16"}),(0,a.jsx)(_.Ql,{value:"INT16",children:"INT16"}),(0,a.jsx)(_.Ql,{value:"UINT32",children:"UINT32"}),(0,a.jsx)(_.Ql,{value:"INT32",children:"INT32"}),(0,a.jsx)(_.Ql,{value:"FLOAT32",children:"FLOAT32"}),(0,a.jsx)(_.Ql,{value:"BOOLEAN",children:"BOOLEAN"})]})]})]}),(0,a.jsxs)("div",{className:"md:col-span-1",children:[(0,a.jsx)(y._,{htmlFor:"multiplier-".concat(t),children:"Multiplier"}),(0,a.jsx)(N.I,{id:"multiplier-".concat(t),type:"number",step:"0.01",value:r.multiplier,onChange:e=>handleDeviceVariableChange(t,"multiplier",parseFloat(e.target.value)),placeholder:"e.g., 1",disabled:"connected"!==e})]})]},t))]}),(0,a.jsxs)(l.z,{onClick:()=>{if(!k.current||!k.current.connected){n.Am.error("MQTT not connected. Cannot add new device.");return}if(!K||!ee.trim()||!et.trim()||!es.trim()){n.Am.error("Section, Manufacturer, Part Number, and Protocol are required to add a device.");return}let e=el.map(e=>{let r="string"==typeof e.relative_address?parseInt(e.relative_address,10):e.relative_address;if(isNaN(r)||""===e.var_name.trim())throw n.Am.error("All 'Var Name' and 'Relative Address' fields in Device Data must be filled correctly."),Error("Invalid device data input.");return{...e,relative_address:r,word_length:Number(e.word_length),multiplier:Number(e.multiplier)}}),r=JSON.stringify({command:"Create Data",section:K,device_params:{manufacturer:ee.trim(),part_number:et.trim(),protocol:es.trim(),data:e}});k.current.publish(R,r,e=>{e?(n.Am.error("Failed to send add device command: ".concat(e.message)),console.error("Publish error:",e)):(n.Am.loading("Adding new device...",{id:"addDeviceToast"}),X(""),er(""),ea(""),en(""),ei([]))})},disabled:"connected"!==e||!K||!ee.trim()||!et.trim()||!es.trim(),children:[(0,a.jsx)(h.Z,{className:"mr-2 h-4 w-4"})," Add Device"]})]})]})]}),(0,a.jsxs)(C.nU,{value:"update",className:"space-y-6 mt-6",children:[(0,a.jsxs)(i.Zb,{children:[(0,a.jsx)(i.Ol,{children:(0,a.jsx)(i.ll,{className:"text-base",children:"Select Device to Update"})}),(0,a.jsxs)(i.aY,{className:"space-y-4",children:[(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Select a device by choosing section, manufacturer, part number, and protocol. Then load the device data for editing."}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(y._,{htmlFor:"update-section",children:"Section (Required)"}),(0,a.jsxs)(_.Ph,{value:ed,onValueChange:e=>{ec(e),eu(""),eh(""),ef(""),eg([]),eb(null),eN(!1)},disabled:"connected"!==e,children:[(0,a.jsx)(_.i4,{id:"update-section",children:(0,a.jsx)(_.ki,{placeholder:"Select section"})}),(0,a.jsx)(_.Bw,{children:eT.length>0?eT.map(e=>(0,a.jsx)(_.Ql,{value:e,children:e.replace(/_/g," ")},e)):(0,a.jsx)(_.Ql,{value:"no-sections-available",disabled:!0,children:"No sections available"})})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(y._,{htmlFor:"update-manufacturer",children:"Manufacturer (Required)"}),(0,a.jsxs)(_.Ph,{value:eo,onValueChange:e=>{eu(e),eh(""),ef(""),eg([]),eb(null),eN(!1)},disabled:"connected"!==e||!ed,children:[(0,a.jsx)(_.i4,{id:"update-manufacturer",children:(0,a.jsx)(_.ki,{placeholder:"Select manufacturer"})}),(0,a.jsx)(_.Bw,{children:eA.length>0?eA.map(e=>(0,a.jsx)(_.Ql,{value:e,children:e},e)):(0,a.jsx)(_.Ql,{value:"no-manufacturers-available",disabled:!0,children:ed?"No manufacturers in this section":"Select section first"})})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(y._,{htmlFor:"update-part-number",children:"Part Number (Required)"}),(0,a.jsxs)(_.Ph,{value:em,onValueChange:e=>{eh(e),ef(""),eg([]),eb(null),eN(!1)},disabled:"connected"!==e||!ed||!eo,children:[(0,a.jsx)(_.i4,{id:"update-part-number",children:(0,a.jsx)(_.ki,{placeholder:"Select part number"})}),(0,a.jsx)(_.Bw,{children:eD.length>0?eD.map(e=>(0,a.jsx)(_.Ql,{value:e,children:e},e)):(0,a.jsx)(_.Ql,{value:"no-parts-available",disabled:!0,children:eo?"No parts for this manufacturer":"Select manufacturer first"})})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(y._,{htmlFor:"update-protocol",children:"Protocol (Required)"}),(0,a.jsxs)(_.Ph,{value:ep,onValueChange:e=>{ef(e),eg([]),eb(null),eN(!1)},disabled:"connected"!==e||!ed||!eo||!em,children:[(0,a.jsx)(_.i4,{id:"update-protocol",children:(0,a.jsx)(_.ki,{placeholder:"Select protocol"})}),(0,a.jsx)(_.Bw,{children:eI.length>0?eI.map(e=>(0,a.jsx)(_.Ql,{value:e,children:e},e)):(0,a.jsx)(_.Ql,{value:"no-protocols-available",disabled:!0,children:em?"No protocols for this part":"Select part number first"})})]})]})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(l.z,{onClick:()=>{if(!ed||!eo||!em||!ep){n.Am.error("Please select section, manufacturer, part number, and protocol first.");return}if(!k.current||!k.current.connected){n.Am.error("MQTT not connected. Cannot load device data.");return}eN(!0),ew(!0);let e=JSON.stringify({edit_params:{section:ed,manufacturer:eo,part_number:em,protocol:ep}});console.log("Sending edit load command:",e),k.current.publish("library/devices/edit/load",e,e=>{e?(n.Am.error("Failed to load device data: ".concat(e.message)),console.error("Publish error:",e),eN(!1),ew(!1)):(n.Am.loading("Loading device data for editing...",{id:"loadDeviceToast"}),setTimeout(()=>{ew(!1)},4e3*Math.random()+1e3))})},disabled:"connected"!==e||!ed||!eo||!em||!ep||ey,children:ey?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(x.Z,{className:"mr-2 h-4 w-4 animate-spin"})," Loading..."]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(m.Z,{className:"mr-2 h-4 w-4"})," Load Device Data"]})}),(0,a.jsxs)(l.z,{variant:"outline",onClick:()=>{ec(""),eu(""),eh(""),ef(""),eg([]),eb(null),eN(!1)},disabled:"connected"!==e,children:[(0,a.jsx)(g.Z,{className:"mr-2 h-4 w-4"})," Reset Selection"]}),(0,a.jsxs)(T.Vq,{open:e_,onOpenChange:eC,children:[(0,a.jsx)(T.hg,{asChild:!0,children:(0,a.jsx)(l.z,{variant:"outline",size:"icon",disabled:"connected"!==e,children:(0,a.jsx)(v.Z,{className:"h-4 w-4"})})}),(0,a.jsxs)(T.cZ,{className:"max-w-2xl",children:[(0,a.jsxs)(T.fK,{children:[(0,a.jsxs)(T.$N,{className:"flex items-center gap-2",children:[(0,a.jsx)(v.Z,{className:"h-5 w-5 text-blue-500"}),"Update Library Usage Guide"]}),(0,a.jsxs)(T.Be,{className:"text-left space-y-4",children:[(0,a.jsxs)("div",{className:"bg-blue-50 p-4 rounded-md border border-blue-200",children:[(0,a.jsx)("h4",{className:"font-semibold text-blue-800 mb-2",children:"How to Update Device Library:"}),(0,a.jsxs)("ol",{className:"list-decimal list-inside space-y-2 text-sm text-blue-700",children:[(0,a.jsxs)("li",{children:[(0,a.jsx)("strong",{children:"Select Section:"})," Choose the device category from the dropdown (e.g., ups, pdu, power_meter)"]}),(0,a.jsxs)("li",{children:[(0,a.jsx)("strong",{children:"Select Manufacturer:"})," Pick the device manufacturer from available options in that section"]}),(0,a.jsxs)("li",{children:[(0,a.jsx)("strong",{children:"Select Part Number:"})," Choose the specific part number for that manufacturer"]}),(0,a.jsxs)("li",{children:[(0,a.jsx)("strong",{children:"Select Protocol:"})," Pick the communication protocol (e.g., Modbus RTU, SNMP)"]}),(0,a.jsxs)("li",{children:[(0,a.jsx)("strong",{children:"Load Device Data:"}),' Click the "Load Device Data" button to fetch current device variables']}),(0,a.jsxs)("li",{children:[(0,a.jsx)("strong",{children:"Edit Variables:"})," Modify, add, or remove device variables as needed using the form below"]}),(0,a.jsxs)("li",{children:[(0,a.jsx)("strong",{children:"Save Changes:"}),' Click "Update Device" to save your modifications to the library']})]})]}),(0,a.jsxs)("div",{className:"bg-green-50 p-4 rounded-md border border-green-200",children:[(0,a.jsx)("h4",{className:"font-semibold text-green-800 mb-2",children:"Variable Fields Explained:"}),(0,a.jsxs)("ul",{className:"list-disc list-inside space-y-1 text-sm text-green-700",children:[(0,a.jsxs)("li",{children:[(0,a.jsx)("strong",{children:"Var Name:"})," Descriptive name for the data point"]}),(0,a.jsxs)("li",{children:[(0,a.jsx)("strong",{children:"Relative Address:"})," Memory address offset for the variable"]}),(0,a.jsxs)("li",{children:[(0,a.jsx)("strong",{children:"Register Type:"})," Modbus register type (Holding, Input, Coil, Discrete)"]}),(0,a.jsxs)("li",{children:[(0,a.jsx)("strong",{children:"Word Length:"})," Number of 16-bit words the variable occupies"]}),(0,a.jsxs)("li",{children:[(0,a.jsx)("strong",{children:"Data Type:"})," Variable data format (UINT16, INT16, FLOAT32, etc.)"]}),(0,a.jsxs)("li",{children:[(0,a.jsx)("strong",{children:"Multiplier:"})," Scaling factor applied to the raw value"]})]})]}),(0,a.jsxs)("div",{className:"bg-yellow-50 p-4 rounded-md border border-yellow-200",children:[(0,a.jsx)("h4",{className:"font-semibold text-yellow-800 mb-2",children:"Important Notes:"}),(0,a.jsxs)("ul",{className:"list-disc list-inside space-y-1 text-sm text-yellow-700",children:[(0,a.jsx)("li",{children:"Loading device data may take 1-5 seconds depending on library size"}),(0,a.jsx)("li",{children:"All dropdowns are cascading - selecting one field affects the next"}),(0,a.jsx)("li",{children:'Use "Reset Selection" to clear all selections and start over'}),(0,a.jsx)("li",{children:"Changes are saved immediately to the device library file"}),(0,a.jsx)("li",{children:"Make sure MQTT connection is active before making changes"})]})]})]})]}),(0,a.jsx)("div",{className:"flex justify-end pt-4",children:(0,a.jsxs)(l.z,{onClick:()=>eC(!1),className:"bg-red-500 hover:bg-red-600 text-white",children:[(0,a.jsx)(f.Z,{className:"mr-2 h-4 w-4"})," Close"]})})]})]})]}),ev&&(0,a.jsxs)("div",{className:"mt-4 p-3 bg-muted rounded-md",children:[(0,a.jsx)("h4",{className:"font-medium mb-2",children:"Selected Device:"}),(0,a.jsxs)("p",{className:"text-sm",children:[(0,a.jsx)("strong",{children:"Section:"})," ",ev.section," |",(0,a.jsx)("strong",{children:" Manufacturer:"})," ",ev.manufacturer," |",(0,a.jsx)("strong",{children:" Part Number:"})," ",ev.part_number," |",(0,a.jsx)("strong",{children:" Protocol:"})," ",ev.protocol]})]})]})]}),ev&&(0,a.jsxs)(i.Zb,{children:[(0,a.jsx)(i.Ol,{children:(0,a.jsx)(i.ll,{className:"text-base",children:"Update Device Variables"})}),(0,a.jsxs)(i.aY,{className:"space-y-4",children:[(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Edit the device variables below. You can add, remove, or modify existing variables."}),(0,a.jsxs)("div",{className:"space-y-3 p-4 border rounded-md bg-secondary/20",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,a.jsx)(y._,{className:"text-base font-semibold",children:"Device Variables"}),(0,a.jsxs)(l.z,{onClick:()=>{eg(e=>[...e,{var_name:"",relative_address:"",register_type:"Holding Register",word_length:1,data_type:"UINT16",multiplier:1}])},type:"button",size:"sm",variant:"outline",disabled:"connected"!==e,children:[(0,a.jsx)(h.Z,{className:"mr-2 h-4 w-4"})," Add Variable"]})]}),0===ex.length&&(0,a.jsx)("p",{className:"text-muted-foreground text-sm",children:'No variables defined. Click "Add Variable" to add data points.'}),ex.map((r,t)=>(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-3 border p-3 rounded-md bg-background relative",children:[(0,a.jsx)(l.z,{onClick:()=>handleRemoveUpdateDeviceVariable(t),type:"button",variant:"ghost",size:"icon",className:"absolute top-2 right-2 h-6 w-6 text-muted-foreground hover:text-red-500",disabled:"connected"!==e,children:(0,a.jsx)(f.Z,{className:"h-4 w-4"})}),(0,a.jsxs)("div",{className:"md:col-span-1",children:[(0,a.jsx)(y._,{htmlFor:"update_var_name-".concat(t),children:"Var Name"}),(0,a.jsx)(N.I,{id:"update_var_name-".concat(t),value:r.var_name,onChange:e=>handleUpdateDeviceVariableChange(t,"var_name",e.target.value),placeholder:"e.g., Status word frequency",disabled:"connected"!==e})]}),(0,a.jsxs)("div",{className:"md:col-span-1",children:[(0,a.jsx)(y._,{htmlFor:"update_relative_address-".concat(t),children:"Relative Address"}),(0,a.jsx)(N.I,{id:"update_relative_address-".concat(t),type:"number",value:r.relative_address,onChange:e=>handleUpdateDeviceVariableChange(t,"relative_address",""===e.target.value?"":parseInt(e.target.value,10)),placeholder:"e.g., 3201",disabled:"connected"!==e})]}),(0,a.jsxs)("div",{className:"md:col-span-1",children:[(0,a.jsx)(y._,{htmlFor:"update_register_type-".concat(t),children:"Register Type"}),(0,a.jsxs)(_.Ph,{value:r.register_type,onValueChange:e=>handleUpdateDeviceVariableChange(t,"register_type",e),disabled:"connected"!==e,children:[(0,a.jsx)(_.i4,{id:"update_register_type-".concat(t),children:(0,a.jsx)(_.ki,{placeholder:"Select type"})}),(0,a.jsxs)(_.Bw,{children:[(0,a.jsx)(_.Ql,{value:"Holding Register",children:"Holding Register"}),(0,a.jsx)(_.Ql,{value:"Input Register",children:"Input Register"}),(0,a.jsx)(_.Ql,{value:"Coil",children:"Coil"}),(0,a.jsx)(_.Ql,{value:"Discrete Input",children:"Discrete Input"})]})]})]}),(0,a.jsxs)("div",{className:"md:col-span-1",children:[(0,a.jsx)(y._,{htmlFor:"update_word_length-".concat(t),children:"Word Length"}),(0,a.jsx)(N.I,{id:"update_word_length-".concat(t),type:"number",value:r.word_length,onChange:e=>handleUpdateDeviceVariableChange(t,"word_length",parseInt(e.target.value,10)),placeholder:"e.g., 1",disabled:"connected"!==e})]}),(0,a.jsxs)("div",{className:"md:col-span-1",children:[(0,a.jsx)(y._,{htmlFor:"update_data_type-".concat(t),children:"Data Type"}),(0,a.jsxs)(_.Ph,{value:r.data_type,onValueChange:e=>handleUpdateDeviceVariableChange(t,"data_type",e),disabled:"connected"!==e,children:[(0,a.jsx)(_.i4,{id:"update_data_type-".concat(t),children:(0,a.jsx)(_.ki,{placeholder:"Select type"})}),(0,a.jsxs)(_.Bw,{children:[(0,a.jsx)(_.Ql,{value:"UINT16",children:"UINT16"}),(0,a.jsx)(_.Ql,{value:"INT16",children:"INT16"}),(0,a.jsx)(_.Ql,{value:"UINT32",children:"UINT32"}),(0,a.jsx)(_.Ql,{value:"INT32",children:"INT32"}),(0,a.jsx)(_.Ql,{value:"FLOAT32",children:"FLOAT32"}),(0,a.jsx)(_.Ql,{value:"BOOLEAN",children:"BOOLEAN"})]})]})]}),(0,a.jsxs)("div",{className:"md:col-span-1",children:[(0,a.jsx)(y._,{htmlFor:"update_multiplier-".concat(t),children:"Multiplier"}),(0,a.jsx)(N.I,{id:"update_multiplier-".concat(t),type:"number",step:"0.01",value:r.multiplier,onChange:e=>handleUpdateDeviceVariableChange(t,"multiplier",parseFloat(e.target.value)),placeholder:"e.g., 1",disabled:"connected"!==e})]})]},t))]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsxs)(l.z,{onClick:()=>{if(!k.current||!k.current.connected){n.Am.error("MQTT not connected. Cannot update device.");return}if(!ed||!eo||!em||!ep){n.Am.error("Device selection is incomplete. Please load a device first.");return}let e=ex.map(e=>{let r="string"==typeof e.relative_address?parseInt(e.relative_address,10):e.relative_address;if(isNaN(r)||""===e.var_name.trim())throw n.Am.error("All 'Var Name' and 'Relative Address' fields in Device Data must be filled correctly."),Error("Invalid device data input.");return{...e,relative_address:r,word_length:Number(e.word_length),multiplier:Number(e.multiplier)}}),r=JSON.stringify({command:"Update Data",section:ed,device_params:{manufacturer:eo,part_number:em,protocol:ep,data:e}});k.current.publish(R,r,e=>{e?(n.Am.error("Failed to send update device command: ".concat(e.message)),console.error("Publish error:",e)):n.Am.loading("Updating device...",{id:"updateDeviceToast"})})},disabled:"connected"!==e||!ev,children:[(0,a.jsx)(b.Z,{className:"mr-2 h-4 w-4"})," Update Device"]}),(0,a.jsxs)(l.z,{onClick:()=>{ei(e=>[...e,{var_name:"",relative_address:"",register_type:"Holding Register",word_length:1,data_type:"UINT16",multiplier:1}])},type:"button",size:"sm",variant:"outline",disabled:"connected"!==e,children:[(0,a.jsx)(h.Z,{className:"mr-2 h-4 w-4"})," Add Variable"]})]})]})]})]}),(0,a.jsx)(C.nU,{value:"files",className:"space-y-6 mt-6",children:(0,a.jsxs)(i.Zb,{children:[(0,a.jsx)(i.Ol,{children:(0,a.jsx)(i.ll,{className:"text-base",children:"devices.json File Control"})}),(0,a.jsxs)(i.aY,{className:"grid md:grid-cols-2 gap-4",children:[(0,a.jsxs)(l.z,{onClick:()=>{confirm("Download devices.json file?")&&downloadFile()},className:"w-full",disabled:"connected"!==e,children:[(0,a.jsx)(j.Z,{className:"mr-2 h-4 w-4"})," Download devices.json"]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(N.I,{type:"file",accept:".json",onChange:e=>{var r;let t=null===(r=e.target.files)||void 0===r?void 0:r[0];if(t){if(A(t.name),"devices.json"!==t.name){n.Am.error("Invalid file. Please select devices.json");return}confirm("Upload and replace devices.json file? This will restart the MODBUS_SNMP service.")&&uploadFile(t),e.target.value=""}},disabled:"connected"!==e}),t&&(0,a.jsxs)("p",{className:"text-xs text-muted-foreground mt-1",children:["Selected: ",t]})]})]})]})})]})})]})}},6577:function(e,r,t){"use strict";t.d(r,{Z:function(){return MQTTConnectionBadge}});var a=t(7437),s=t(9035),n=t(708),l=t(4530),i=t(4631),d=t(9806),c=t(3715);function MQTTConnectionBadge(){let e=(0,s.w)(),{color:r,icon:t,label:o}=(()=>{switch(e){case"connected":return{color:"bg-green-500",icon:(0,a.jsx)(l.Z,{className:"w-4 h-4 mr-1"}),label:"Connected"};case"disconnected":return{color:"bg-yellow-500",icon:(0,a.jsx)(i.Z,{className:"w-4 h-4 mr-1"}),label:"Disconnected"};case"error":return{color:"bg-red-500",icon:(0,a.jsx)(d.Z,{className:"w-4 h-4 mr-1"}),label:"Error"};default:return{color:"bg-gray-400",icon:(0,a.jsx)(c.Z,{className:"w-4 h-4 mr-1 animate-spin"}),label:"Connecting..."}}})();return(0,a.jsxs)(n.C,{className:"flex items-center ".concat(r," text-white px-2 py-1"),children:[t,(0,a.jsx)("span",{className:"text-sm",children:o})]})}},708:function(e,r,t){"use strict";t.d(r,{C:function(){return Badge}});var a=t(7437);t(2265);var s=t(6061),n=t(1628);let l=(0,s.j)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",info:"border-transparent bg-blue-500 text-white hover:bg-blue-600",success:"border-transparent bg-green-500 text-white hover:bg-green-600",warning:"border-transparent bg-yellow-400 text-yellow-900 hover:bg-yellow-500",outline:"bg-transparent border-foreground text-foreground",outlineInfo:"bg-transparent border-blue-500 text-blue-600",outlineSuccess:"bg-transparent border-green-500 text-green-600",outlineWarning:"bg-transparent border-yellow-400 text-yellow-700",outlineDestructive:"bg-transparent border-destructive text-destructive",gradientInfo:"border-0 bg-gradient-to-r from-blue-400/50 to-blue-600/50 text-blue-900",gradientSuccess:"border-0 bg-gradient-to-r from-green-400/50 to-green-600/50 text-green-900",gradientWarning:"border-0 bg-gradient-to-r from-yellow-300/50 to-yellow-500/50 text-yellow-900",gradientDestructive:"border-0 bg-gradient-to-r from-red-400/50 to-red-600/50 text-red-900"}},defaultVariants:{variant:"default"}});function Badge(e){let{className:r,variant:t,...s}=e;return(0,a.jsx)("div",{className:(0,n.cn)(l({variant:t}),r),...s})}},9598:function(e,r,t){"use strict";t.d(r,{Ol:function(){return i},SZ:function(){return c},Zb:function(){return l},aY:function(){return o},eW:function(){return u},ll:function(){return d}});var a=t(7437),s=t(2265),n=t(1628);let l=s.forwardRef((e,r)=>{let{className:t,...s}=e;return(0,a.jsx)("div",{ref:r,className:(0,n.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",t),...s})});l.displayName="Card";let i=s.forwardRef((e,r)=>{let{className:t,...s}=e;return(0,a.jsx)("div",{ref:r,className:(0,n.cn)("flex flex-col space-y-1.5 p-6",t),...s})});i.displayName="CardHeader";let d=s.forwardRef((e,r)=>{let{className:t,...s}=e;return(0,a.jsx)("div",{ref:r,className:(0,n.cn)("text-2xl font-semibold leading-none tracking-tight",t),...s})});d.displayName="CardTitle";let c=s.forwardRef((e,r)=>{let{className:t,...s}=e;return(0,a.jsx)("div",{ref:r,className:(0,n.cn)("text-sm text-muted-foreground",t),...s})});c.displayName="CardDescription";let o=s.forwardRef((e,r)=>{let{className:t,...s}=e;return(0,a.jsx)("div",{ref:r,className:(0,n.cn)("p-6 pt-0",t),...s})});o.displayName="CardContent";let u=s.forwardRef((e,r)=>{let{className:t,...s}=e;return(0,a.jsx)("div",{ref:r,className:(0,n.cn)("flex items-center p-6 pt-0",t),...s})});u.displayName="CardFooter"},2031:function(e,r,t){"use strict";t.d(r,{$N:function(){return h},Be:function(){return p},Vq:function(){return d},cN:function(){return DialogFooter},cZ:function(){return m},fK:function(){return DialogHeader},hg:function(){return c}});var a=t(7437),s=t(2265),n=t(8712),l=t(2549),i=t(1628);let d=n.fC,c=n.xz,o=n.h_;n.x8;let u=s.forwardRef((e,r)=>{let{className:t,...s}=e;return(0,a.jsx)(n.aV,{ref:r,className:(0,i.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...s})});u.displayName=n.aV.displayName;let m=s.forwardRef((e,r)=>{let{className:t,children:s,...d}=e;return(0,a.jsxs)(o,{children:[(0,a.jsx)(u,{}),(0,a.jsxs)(n.VY,{ref:r,className:(0,i.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",t),...d,children:[s,(0,a.jsxs)(n.x8,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,a.jsx)(l.Z,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});m.displayName=n.VY.displayName;let DialogHeader=e=>{let{className:r,...t}=e;return(0,a.jsx)("div",{className:(0,i.cn)("flex flex-col space-y-1.5 text-center sm:text-left",r),...t})};DialogHeader.displayName="DialogHeader";let DialogFooter=e=>{let{className:r,...t}=e;return(0,a.jsx)("div",{className:(0,i.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",r),...t})};DialogFooter.displayName="DialogFooter";let h=s.forwardRef((e,r)=>{let{className:t,...s}=e;return(0,a.jsx)(n.Dx,{ref:r,className:(0,i.cn)("text-lg font-semibold leading-none tracking-tight",t),...s})});h.displayName=n.Dx.displayName;let p=s.forwardRef((e,r)=>{let{className:t,...s}=e;return(0,a.jsx)(n.dk,{ref:r,className:(0,i.cn)("text-sm text-muted-foreground",t),...s})});p.displayName=n.dk.displayName},1465:function(e,r,t){"use strict";t.d(r,{_:function(){return c}});var a=t(7437),s=t(2265),n=t(6743),l=t(6061),i=t(1628);let d=(0,l.j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),c=s.forwardRef((e,r)=>{let{className:t,...s}=e;return(0,a.jsx)(n.f,{ref:r,className:(0,i.cn)(d(),t),...s})});c.displayName=n.f.displayName},7532:function(e,r,t){"use strict";t.d(r,{Bw:function(){return x},DI:function(){return u},Ph:function(){return o},Ql:function(){return v},i4:function(){return h},ki:function(){return m},n5:function(){return g}});var a=t(7437),s=t(2265),n=t(6337),l=t(3523),i=t(9224),d=t(2442),c=t(1628);let o=n.fC,u=n.ZA,m=n.B4,h=s.forwardRef((e,r)=>{let{className:t,children:s,...i}=e;return(0,a.jsxs)(n.xz,{ref:r,className:(0,c.cn)("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",t),...i,children:[s,(0,a.jsx)(n.JO,{asChild:!0,children:(0,a.jsx)(l.Z,{className:"h-4 w-4 opacity-50"})})]})});h.displayName=n.xz.displayName;let p=s.forwardRef((e,r)=>{let{className:t,...s}=e;return(0,a.jsx)(n.u_,{ref:r,className:(0,c.cn)("flex cursor-default items-center justify-center py-1",t),...s,children:(0,a.jsx)(i.Z,{className:"h-4 w-4"})})});p.displayName=n.u_.displayName;let f=s.forwardRef((e,r)=>{let{className:t,...s}=e;return(0,a.jsx)(n.$G,{ref:r,className:(0,c.cn)("flex cursor-default items-center justify-center py-1",t),...s,children:(0,a.jsx)(l.Z,{className:"h-4 w-4"})})});f.displayName=n.$G.displayName;let x=s.forwardRef((e,r)=>{let{className:t,children:s,position:l="popper",...i}=e;return(0,a.jsx)(n.h_,{children:(0,a.jsxs)(n.VY,{ref:r,className:(0,c.cn)("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===l&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",t),position:l,...i,children:[(0,a.jsx)(p,{}),(0,a.jsx)(n.l_,{className:(0,c.cn)("p-1","popper"===l&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:s}),(0,a.jsx)(f,{})]})})});x.displayName=n.VY.displayName;let g=s.forwardRef((e,r)=>{let{className:t,...s}=e;return(0,a.jsx)(n.__,{ref:r,className:(0,c.cn)("py-1.5 pl-8 pr-2 text-sm font-semibold",t),...s})});g.displayName=n.__.displayName;let v=s.forwardRef((e,r)=>{let{className:t,children:s,...l}=e;return(0,a.jsxs)(n.ck,{ref:r,className:(0,c.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),...l,children:[(0,a.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,a.jsx)(n.wU,{children:(0,a.jsx)(d.Z,{className:"h-4 w-4"})})}),(0,a.jsx)(n.eT,{children:s})]})});v.displayName=n.ck.displayName;let b=s.forwardRef((e,r)=>{let{className:t,...s}=e;return(0,a.jsx)(n.Z0,{ref:r,className:(0,c.cn)("-mx-1 my-1 h-px bg-muted",t),...s})});b.displayName=n.Z0.displayName},1750:function(e,r,t){"use strict";t.d(r,{SP:function(){return c},dr:function(){return d},mQ:function(){return i},nU:function(){return o}});var a=t(7437),s=t(2265),n=t(7094),l=t(1628);let i=n.fC,d=s.forwardRef((e,r)=>{let{className:t,...s}=e;return(0,a.jsx)(n.aV,{ref:r,className:(0,l.cn)("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",t),...s})});d.displayName=n.aV.displayName;let c=s.forwardRef((e,r)=>{let{className:t,...s}=e;return(0,a.jsx)(n.xz,{ref:r,className:(0,l.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",t),...s})});c.displayName=n.xz.displayName;let o=s.forwardRef((e,r)=>{let{className:t,...s}=e;return(0,a.jsx)(n.VY,{ref:r,className:(0,l.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",t),...s})});o.displayName=n.VY.displayName},9035:function(e,r,t){"use strict";t.d(r,{w:function(){return useMQTTStatus}});var a=t(2265),s=t(5344);function useMQTTStatus(){let e=(0,s.Oh)(),[r,t]=(0,a.useState)(()=>e?e.connected?"connected":e.disconnected?"disconnected":"connecting":"connecting");return(0,a.useEffect)(()=>{let e=(0,s.kS)();e.connected?t("connected"):e.disconnected?t("disconnected"):t("connecting");let handleConnect=()=>t("connected"),handleError=()=>t("error"),handleClose=()=>t("disconnected"),handleReconnect=()=>t("connecting"),handleOffline=()=>t("disconnected");return e.on("connect",handleConnect),e.on("error",handleError),e.on("close",handleClose),e.on("reconnect",handleReconnect),e.on("offline",handleOffline),()=>{e.off("connect",handleConnect),e.off("error",handleError),e.off("close",handleClose),e.off("reconnect",handleReconnect),e.off("offline",handleOffline)}},[]),r}},5344:function(e,r,t){"use strict";t.d(r,{kS:function(){return connectMQTT},Oh:function(){return getMQTTClient}});var a=t(7406);function getAppConfig(){let e,r;let t=window.location.protocol;if("https:"===t?(e="ws://192.168.0.106:9000",r="http://192.168.0.100:8000"):(e="ws://".concat(window.location.hostname,":9000"),r="http://".concat(window.location.hostname,":8000")),!e)throw Error("MQTT broker URL is not defined.");if(!r)throw Error("API base URL is not defined.");return{mqttBrokerUrl:e,apiBaseUrl:r}}let s=null,n=!1;function connectMQTT(){let{mqttBrokerUrl:e}=getAppConfig();if(!e)throw Error("MQTT broker URL is missing from configuration.");if(s&&(s.connected||n))return s;if(!s||s.disconnected){if(n)return s;n=!0,console.log("MQTT: Attempting connection to ".concat(e,"...")),(s=a.Z.connect(e,{clean:!0,connectTimeout:3e3,reconnectPeriod:1e3})).on("connect",()=>{console.log("MQTT: Connected to ".concat(e)),n=!1}),s.on("error",e=>{console.error("MQTT Error: ".concat(e.message)),n=!1}),s.on("reconnect",()=>{console.log("MQTT: Reconnecting to ".concat(e)),n=!0}),s.on("close",()=>{console.log("MQTT: Connection to ".concat(e," closed.")),n=!1}),s.on("offline",()=>{console.log("MQTT: Client is offline."),n=!1})}return s}function getMQTTClient(){return s}}},function(e){e.O(0,[2793,9461,9848,5348,6107,2995,5848,307,2971,2472,1744],function(){return e(e.s=8520)}),_N_E=e.O()}]);