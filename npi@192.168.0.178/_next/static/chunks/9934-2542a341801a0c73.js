(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9934],{4530:function(e,t,n){"use strict";n.d(t,{Z:function(){return s}});var r=n(5531);let s=(0,r.Z)("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},9806:function(e,t,n){"use strict";n.d(t,{Z:function(){return s}});var r=n(5531);let s=(0,r.Z)("circle-x",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]])},5458:function(e,t,n){"use strict";n.d(t,{Z:function(){return s}});var r=n(5531);let s=(0,r.Z)("cpu",[["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M17 20v2",key:"1rnc9c"}],["path",{d:"M17 2v2",key:"11trls"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M2 17h2",key:"7oei6x"}],["path",{d:"M2 7h2",key:"asdhe0"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"M20 17h2",key:"1fpfkl"}],["path",{d:"M20 7h2",key:"1o8tra"}],["path",{d:"M7 20v2",key:"4gnj0m"}],["path",{d:"M7 2v2",key:"1i4yhu"}],["rect",{x:"4",y:"4",width:"16",height:"16",rx:"2",key:"1vbyd7"}],["rect",{x:"8",y:"8",width:"8",height:"8",rx:"1",key:"z9xiuo"}]])},5119:function(e,t,n){"use strict";n.d(t,{Z:function(){return s}});var r=n(5531);let s=(0,r.Z)("layout-dashboard",[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]])},3715:function(e,t,n){"use strict";n.d(t,{Z:function(){return s}});var r=n(5531);let s=(0,r.Z)("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},4631:function(e,t,n){"use strict";n.d(t,{Z:function(){return s}});var r=n(5531);let s=(0,r.Z)("triangle-alert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]])},9934:function(e,t,n){Promise.resolve().then(n.bind(n,8813))},8813:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return OverviewDashboard}});var r=n(7437),s=n(2265),i=n(307),l=n(5217),o=n(5119),a=n(5458),c=n(261),d=n(8784);function getCurrentTime(){let e=new Date,t=e.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!0}),n=e.toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"});return"".concat(n," - ").concat(t)}function RealtimeClockWithRefresh(){let[e,t]=(0,s.useState)(""),[n,i]=(0,s.useState)(!1);return((0,s.useEffect)(()=>{i(!0);let e=setInterval(()=>{t(getCurrentTime())},1e3);return()=>clearInterval(e)},[]),n)?(0,r.jsx)("div",{className:"flex items-center gap-3 text-sm text-muted-foreground",children:(0,r.jsx)("span",{children:e})}):null}var u=n(3086),f=n(3611);function Refresh(){return(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(f.z,{variant:"outline",size:"icon",className:"h-8 w-8",onClick:()=>window.location.reload(),title:"Refresh halaman",children:(0,r.jsx)(u.Z,{className:"h-4 w-4"})})})}var m=n(6577),x=n(9598),h=n(1750),g=n(5344),v=n(5887),b=n(708);function OverviewDashboard(){let e,t;let[n,u]=(0,s.useState)([]),[f,p]=(0,s.useState)(null),[y,j]=(0,s.useState)({}),[N,w]=(0,s.useState)({});(0,s.useEffect)(()=>{let e=(0,g.kS)();if(!e)return;let t=new Set,handleMessage=(n,r)=>{try{let s=JSON.parse(r.toString());if("response_device_modbus"===n)Array.isArray(s)&&(u(s),s.forEach(n=>{var r;let s=null===(r=n.profile)||void 0===r?void 0:r.topic;s&&!t.has(s)&&(e.subscribe(s),t.add(s))}));else if("batteryCharger"===n)p(s);else if("modbus_snmp_summ"===n){let e=s["MODBUS SNMP STATUS"];if("string"==typeof e){let t=e.match(/^(.*?)\s+(.+?)$/);if(t){let e=t[1],n=t[2];j(t=>({...t,[e]:n}))}}}else w(e=>({...e,[n]:s}))}catch(e){console.error("[MQTT] Invalid JSON:",e)}};e.on("message",handleMessage);let n=["response_device_modbus","batteryCharger","modbus_snmp_summ"];return n.forEach(t=>e.subscribe(t)),e.publish("command_device_modbus",JSON.stringify({command:"getDataModbus"})),()=>{n.forEach(t=>e.unsubscribe(t)),t.forEach(t=>e.unsubscribe(t)),e.off("message",handleMessage)}},[]);let k=(e=0,t=0,n.forEach(n=>{var r;let s=y[null===(r=n.profile)||void 0===r?void 0:r.name];(null==s?void 0:s.includes("success"))?e++:t++}),{online:e,offline:t}),M=n.length,T=k.online,C=k.offline;return(0,r.jsxs)(i.kV,{children:[(0,r.jsxs)("header",{className:"flex h-16 shrink-0 items-center gap-2 border-b px-4",children:[(0,r.jsx)(i.vP,{className:"-ml-1"}),(0,r.jsx)(l.Z,{orientation:"vertical",className:"mr-2 h-4"}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(o.Z,{className:"h-5 w-5"}),(0,r.jsx)("h1",{className:"text-lg font-semibold",children:"Battery Charging System"})]}),(0,r.jsxs)("div",{className:"ml-auto flex items-center gap-2",children:[!(0,v.d)()&&(0,r.jsx)(RealtimeClockWithRefresh,{}),(0,r.jsx)(Refresh,{})]})]}),(0,r.jsxs)("div",{className:"flex flex-1 flex-col gap-4 p-4",children:[(0,r.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:[(0,r.jsxs)(x.Zb,{className:"shadow-sm hover:shadow-md transition-shadow",children:[(0,r.jsxs)(x.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,r.jsx)(x.ll,{className:"text-sm font-medium",children:"Total Devices"}),(0,r.jsx)(a.Z,{className:"h-5 w-5 text-muted-foreground"})]}),(0,r.jsxs)(x.aY,{children:[(0,r.jsx)("div",{className:"text-2xl font-bold",children:M}),(0,r.jsxs)("div",{className:"flex justify-between items-center mt-1",children:[(0,r.jsx)("p",{className:"text-xs text-muted-foreground",children:"All registered devices"}),0===M&&(0,r.jsx)("div",{className:"px-2 py-0.5 rounded-full bg-blue-100 text-blue-600 text-xs font-medium border border-blue-300",children:"No devices registered"})]})]})]}),(0,r.jsxs)(x.Zb,{className:"shadow-sm hover:shadow-md transition-shadow",children:[(0,r.jsxs)(x.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,r.jsx)(x.ll,{className:"text-sm font-medium",children:"Online"}),(0,r.jsx)(c.Z,{className:"h-5 w-5 text-green-500"})]}),(0,r.jsxs)(x.aY,{children:[(0,r.jsx)("div",{className:"text-2xl font-bold",children:T}),(0,r.jsxs)("div",{className:"flex justify-between items-center mt-1",children:[(0,r.jsx)("p",{className:"text-xs text-muted-foreground",children:"Devices currently online"}),M===T&&M>0&&(0,r.jsx)("div",{className:"px-2 py-0.5 rounded-full bg-green-100 text-green-600 text-xs font-medium border border-green-300",children:"All devices are online"})]})]})]}),(0,r.jsxs)(x.Zb,{className:"shadow-sm hover:shadow-md transition-shadow",children:[(0,r.jsxs)(x.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,r.jsx)(x.ll,{className:"text-sm font-medium",children:"Offline"}),(0,r.jsx)(d.Z,{className:"h-5 w-5 text-red-500"})]}),(0,r.jsxs)(x.aY,{children:[(0,r.jsx)("div",{className:"text-2xl font-bold",children:C}),(0,r.jsxs)("div",{className:"flex justify-between items-center mt-1",children:[(0,r.jsx)("p",{className:"text-xs text-muted-foreground",children:"Devices currently offline"}),M>0&&0===T&&(0,r.jsx)("div",{className:"px-2 py-0.5 rounded-full bg-red-100 text-red-600 text-xs font-medium border border-red-300",children:"All devices are offline"})]})]})]})]}),(0,r.jsxs)(h.mQ,{defaultValue:"modbus",className:"w-full mt-4",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)(h.dr,{children:[(0,r.jsx)(h.SP,{value:"modbus",children:"Device Modbus/SNMP"}),(0,r.jsx)(h.SP,{value:"battery",children:"Battery Charger"})]}),(0,r.jsx)(m.Z,{})]}),(0,r.jsx)(h.nU,{value:"modbus",className:"mt-2",children:(0,r.jsxs)(x.Zb,{children:[(0,r.jsxs)(x.Ol,{children:[(0,r.jsx)(x.ll,{children:"Device Modbus/SNMP"}),(0,r.jsx)(x.SZ,{children:"List of Modbus/SNMP devices"})]}),(0,r.jsx)(x.aY,{className:"text-sm text-muted-foreground",children:0===n.length?(0,r.jsx)("div",{children:"No Modbus/SNMP devices found."}):(0,r.jsx)("ul",{className:"space-y-4",children:n.map((e,t)=>{var n,s,i,l,o,a,c,d,u,f,m;return(0,r.jsxs)("li",{className:"border-b pb-2",children:[(0,r.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"font-semibold",children:null===(n=e.profile)||void 0===n?void 0:n.name}),(0,r.jsxs)("span",{className:"ml-2 text-xs text-muted-foreground",children:["(",null===(s=e.profile)||void 0===s?void 0:s.part_number,")"]}),(0,r.jsx)("div",{className:"text-xs",children:(null===(i=e.protocol_setting)||void 0===i?void 0:i.protocol)==="Modbus RTU"?"Address: ".concat(null===(l=e.protocol_setting)||void 0===l?void 0:l.address):"IP: ".concat(null===(o=e.protocol_setting)||void 0===o?void 0:o.ip_address)}),(0,r.jsxs)("div",{className:"text-xs",children:["Topic: ",null===(a=e.profile)||void 0===a?void 0:a.topic]})]}),(0,r.jsx)("span",{className:"text-xs font-semibold ml-2 ".concat((null===(c=y[null===(d=e.profile)||void 0===d?void 0:d.name])||void 0===c?void 0:c.includes("success"))?"text-green-600 bg-green-200":"text-red-600 bg-red-200"," rounded-full px-2 py-1"),children:(null===(u=y[null===(f=e.profile)||void 0===f?void 0:f.name])||void 0===u?void 0:u.includes("success"))?"Online":"Offline"})]}),(0,r.jsxs)("div",{className:"text-xs mt-1",children:[(0,r.jsx)("span",{className:"font-semibold",children:"Live Data:"}),(0,r.jsxs)("div",{className:"flex flex-wrap gap-1 mt-1",children:[" ",(()=>{var t;let n=N[null===(t=e.profile)||void 0===t?void 0:t.topic];if(!n)return(0,r.jsx)(b.C,{variant:"secondary",children:"Waiting..."});try{let e=n.value?JSON.parse(n.value):{};return Object.entries(e).map(e=>{let[t,n]=e;return(0,r.jsxs)(b.C,{variant:"outline",className:"text-[10px] px-2 py-0.5",children:[t,": ",String(n)]},t)})}catch(e){return(0,r.jsx)(b.C,{variant:"destructive",children:"Invalid JSON"})}})()]})]})]},(null===(m=e.profile)||void 0===m?void 0:m.name)||t)})})})]})}),(0,r.jsx)(h.nU,{value:"battery",className:"mt-2",children:(0,r.jsxs)(x.Zb,{children:[(0,r.jsxs)(x.Ol,{children:[(0,r.jsx)(x.ll,{children:"Battery Charger"}),(0,r.jsx)(x.SZ,{children:"Live data from charger via MQTT"})]}),(0,r.jsx)(x.aY,{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:f?Object.entries(f).map(e=>{let[t,n]=e;return(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"font-semibold",children:t}),(0,r.jsx)("div",{className:"text-muted-foreground",children:String(n)})]},t)}):(0,r.jsx)("div",{className:"col-span-full text-center",children:"Waiting for battery data..."})})]})})]})]})]})}},6577:function(e,t,n){"use strict";n.d(t,{Z:function(){return MQTTConnectionBadge}});var r=n(7437),s=n(9035),i=n(708),l=n(4530),o=n(4631),a=n(9806),c=n(3715);function MQTTConnectionBadge(){let e=(0,s.w)(),{color:t,icon:n,label:d}=(()=>{switch(e){case"connected":return{color:"bg-green-500",icon:(0,r.jsx)(l.Z,{className:"w-4 h-4 mr-1"}),label:"Connected"};case"disconnected":return{color:"bg-yellow-500",icon:(0,r.jsx)(o.Z,{className:"w-4 h-4 mr-1"}),label:"Disconnected"};case"error":return{color:"bg-red-500",icon:(0,r.jsx)(a.Z,{className:"w-4 h-4 mr-1"}),label:"Error"};default:return{color:"bg-gray-400",icon:(0,r.jsx)(c.Z,{className:"w-4 h-4 mr-1 animate-spin"}),label:"Connecting..."}}})();return(0,r.jsxs)(i.C,{className:"flex items-center ".concat(t," text-white px-2 py-1"),children:[n,(0,r.jsx)("span",{className:"text-sm",children:d})]})}},708:function(e,t,n){"use strict";n.d(t,{C:function(){return Badge}});var r=n(7437);n(2265);var s=n(6061),i=n(1628);let l=(0,s.j)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",info:"border-transparent bg-blue-500 text-white hover:bg-blue-600",success:"border-transparent bg-green-500 text-white hover:bg-green-600",warning:"border-transparent bg-yellow-400 text-yellow-900 hover:bg-yellow-500",outline:"bg-transparent border-foreground text-foreground",outlineInfo:"bg-transparent border-blue-500 text-blue-600",outlineSuccess:"bg-transparent border-green-500 text-green-600",outlineWarning:"bg-transparent border-yellow-400 text-yellow-700",outlineDestructive:"bg-transparent border-destructive text-destructive",gradientInfo:"border-0 bg-gradient-to-r from-blue-400/50 to-blue-600/50 text-blue-900",gradientSuccess:"border-0 bg-gradient-to-r from-green-400/50 to-green-600/50 text-green-900",gradientWarning:"border-0 bg-gradient-to-r from-yellow-300/50 to-yellow-500/50 text-yellow-900",gradientDestructive:"border-0 bg-gradient-to-r from-red-400/50 to-red-600/50 text-red-900"}},defaultVariants:{variant:"default"}});function Badge(e){let{className:t,variant:n,...s}=e;return(0,r.jsx)("div",{className:(0,i.cn)(l({variant:n}),t),...s})}},9598:function(e,t,n){"use strict";n.d(t,{Ol:function(){return o},SZ:function(){return c},Zb:function(){return l},aY:function(){return d},eW:function(){return u},ll:function(){return a}});var r=n(7437),s=n(2265),i=n(1628);let l=s.forwardRef((e,t)=>{let{className:n,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,i.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",n),...s})});l.displayName="Card";let o=s.forwardRef((e,t)=>{let{className:n,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,i.cn)("flex flex-col space-y-1.5 p-6",n),...s})});o.displayName="CardHeader";let a=s.forwardRef((e,t)=>{let{className:n,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,i.cn)("text-2xl font-semibold leading-none tracking-tight",n),...s})});a.displayName="CardTitle";let c=s.forwardRef((e,t)=>{let{className:n,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,i.cn)("text-sm text-muted-foreground",n),...s})});c.displayName="CardDescription";let d=s.forwardRef((e,t)=>{let{className:n,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,i.cn)("p-6 pt-0",n),...s})});d.displayName="CardContent";let u=s.forwardRef((e,t)=>{let{className:n,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,i.cn)("flex items-center p-6 pt-0",n),...s})});u.displayName="CardFooter"},1750:function(e,t,n){"use strict";n.d(t,{SP:function(){return c},dr:function(){return a},mQ:function(){return o},nU:function(){return d}});var r=n(7437),s=n(2265),i=n(7094),l=n(1628);let o=i.fC,a=s.forwardRef((e,t)=>{let{className:n,...s}=e;return(0,r.jsx)(i.aV,{ref:t,className:(0,l.cn)("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",n),...s})});a.displayName=i.aV.displayName;let c=s.forwardRef((e,t)=>{let{className:n,...s}=e;return(0,r.jsx)(i.xz,{ref:t,className:(0,l.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",n),...s})});c.displayName=i.xz.displayName;let d=s.forwardRef((e,t)=>{let{className:n,...s}=e;return(0,r.jsx)(i.VY,{ref:t,className:(0,l.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",n),...s})});d.displayName=i.VY.displayName},9035:function(e,t,n){"use strict";n.d(t,{w:function(){return useMQTTStatus}});var r=n(2265),s=n(5344);function useMQTTStatus(){let e=(0,s.Oh)(),[t,n]=(0,r.useState)(()=>e?e.connected?"connected":e.disconnected?"disconnected":"connecting":"connecting");return(0,r.useEffect)(()=>{let e=(0,s.kS)();e.connected?n("connected"):e.disconnected?n("disconnected"):n("connecting");let handleConnect=()=>n("connected"),handleError=()=>n("error"),handleClose=()=>n("disconnected"),handleReconnect=()=>n("connecting"),handleOffline=()=>n("disconnected");return e.on("connect",handleConnect),e.on("error",handleError),e.on("close",handleClose),e.on("reconnect",handleReconnect),e.on("offline",handleOffline),()=>{e.off("connect",handleConnect),e.off("error",handleError),e.off("close",handleClose),e.off("reconnect",handleReconnect),e.off("offline",handleOffline)}},[]),t}},5344:function(e,t,n){"use strict";n.d(t,{kS:function(){return connectMQTT},Oh:function(){return getMQTTClient}});var r=n(7406);function getAppConfig(){let e,t;let n=window.location.protocol;if("https:"===n?(e="ws://192.168.0.106:9000",t="http://192.168.0.100:8000"):(e="ws://".concat(window.location.hostname,":9000"),t="http://".concat(window.location.hostname,":8000")),!e)throw Error("MQTT broker URL is not defined.");if(!t)throw Error("API base URL is not defined.");return{mqttBrokerUrl:e,apiBaseUrl:t}}let s=null,i=!1;function connectMQTT(){let{mqttBrokerUrl:e}=getAppConfig();if(!e)throw Error("MQTT broker URL is missing from configuration.");if(s&&(s.connected||i))return s;if(!s||s.disconnected){if(i)return s;i=!0,console.log("MQTT: Attempting connection to ".concat(e,"...")),(s=r.Z.connect(e,{clean:!0,connectTimeout:3e3,reconnectPeriod:1e3})).on("connect",()=>{console.log("MQTT: Connected to ".concat(e)),i=!1}),s.on("error",e=>{console.error("MQTT Error: ".concat(e.message)),i=!1}),s.on("reconnect",()=>{console.log("MQTT: Reconnecting to ".concat(e)),i=!0}),s.on("close",()=>{console.log("MQTT: Connection to ".concat(e," closed.")),i=!1}),s.on("offline",()=>{console.log("MQTT: Client is offline."),i=!1})}return s}function getMQTTClient(){return s}}}]);